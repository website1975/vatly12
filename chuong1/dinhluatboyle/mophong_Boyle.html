<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√¥ ph·ªèng ƒê·ªãnh lu·∫≠t Boyle-Mariotte</title>
    <!-- T·∫£i Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <!-- T·∫£i Chart.js cho ƒë·ªì th·ªã --><script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <style>
        /* Thi·∫øt l·∫≠p font Inter */
        body { font-family: 'Inter', sans-serif; }
        /* ƒê·∫£m b·∫£o canvas ph·∫£n h·ªìi t·ªët */
        #simulationCanvas {
            width: 100%;
            height: 300px; /* Chi·ªÅu cao c·ªë ƒë·ªãnh cho m√¥ ph·ªèng */
            background-color: #e0f2f1; /* N·ªÅn xanh nh·∫°t */
            border-radius: 0.75rem;
            border: 2px solid #00796b;
        }
        .data-table-container {
            max-height: 400px;
            overflow-y: auto;
        }
        /* Custom styling for range input */
        input[type=range]::-webkit-slider-thumb {
            background: #00796b;
        }
        input[type=range]::-moz-range-thumb {
            background: #00796b;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-teal': '#00796b',
                        'secondary-cyan': '#00bcd4',
                        'comparison-blue': '#3b82f6',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 min-h-screen p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <h1 class="text-4xl font-extrabold text-primary-teal mb-6 text-center">
            üß™ M√¥ ph·ªèng ƒê·ªãnh lu·∫≠t Boyle-Mariotte ($P \cdot V \propto T$)
        </h1>

        <!-- Container 3 c·ªôt --><div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

            <!-- C·ªôt 1: M√¥ ph·ªèng h√¨nh th√≠ nghi·ªám (Xi lanh - Piston) --><div class="bg-white p-6 rounded-xl shadow-2xl border-b-4 border-primary-teal flex flex-col">
                <h2 class="text-2xl font-semibold mb-4 text-primary-teal border-b pb-2">1. M√¥ ph·ªèng Th√≠ nghi·ªám Hi·ªán t·∫°i</h2>

                <!-- Canvas cho xi lanh --><canvas id="simulationCanvas" class="mb-4"></canvas>

                <!-- B·∫£ng hi·ªÉn th·ªã th√¥ng s·ªë hi·ªán t·∫°i --><div class="bg-gray-100 p-4 rounded-lg shadow-inner text-sm space-y-2 font-mono">
                    <p>√Åp su·∫•t hi·ªán t·∫°i ($P$): <span id="pressureDisplay" class="font-bold text-red-600">100 kPa</span></p>
                    <p>Th·ªÉ t√≠ch hi·ªán t·∫°i ($V$): <span id="volumeDisplay" class="font-bold text-blue-600">10.0 ƒë∆°n v·ªã</span></p>
                    <p>Nhi·ªát ƒë·ªô (<span id="tempCurrentUnit">T</span>): <span id="temperatureDisplay" class="font-bold text-green-600">300 K</span></p>
                    <p>H·∫±ng s·ªë ($P \cdot V$): <span id="constantPV" class="font-bold text-purple-600">1000.0</span></p>
                </div>

                <!-- Thanh ƒëi·ªÅu khi·ªÉn Nhi·ªát ƒë·ªô --><div class="mt-6 border-t pt-4">
                    <label for="tempSlider" class="block text-lg font-medium text-gray-700 mb-2">
                        üå°Ô∏è ƒêi·ªÅu ch·ªânh Nhi·ªát ƒë·ªô ($T_{\text{current}}$):
                    </label>
                    <input type="range" id="tempSlider" min="200" max="600" step="10" value="300"
                           class="w-full h-2 bg-green-400 rounded-lg appearance-none cursor-pointer range-lg" oninput="updateTemperature()">
                    <p class="text-center text-xs text-gray-500 mt-1">Ph·∫°m vi: 200 K - 600 K</p>
                </div>

                <!-- Thanh ƒëi·ªÅu khi·ªÉn Th·ªÉ t√≠ch --><div class="mt-4">
                    <label for="volumeSlider" class="block text-lg font-medium text-gray-700 mb-2">
                        ƒêi·ªÅu ch·ªânh Th·ªÉ t√≠ch ($V$):
                    </label>
                    <input type="range" id="volumeSlider" min="5" max="20" step="0.1" value="10.0"
                           class="w-full h-2 bg-secondary-cyan rounded-lg appearance-none cursor-pointer range-lg">
                </div>

                <!-- N√∫t ghi l·∫°i gi√° tr·ªã --><button id="recordButton"
                        class="mt-4 w-full bg-primary-teal hover:bg-teal-700 text-white font-bold py-3 rounded-xl transition duration-300 shadow-md">
                    üìù Ghi l·∫°i Gi√° tr·ªã & V·∫Ω ƒë·ªì th·ªã
                </button>
            </div>

            <!-- C·ªôt 2: B·∫£ng gi√° tr·ªã V v√† P --><div class="bg-white p-6 rounded-xl shadow-2xl border-b-4 border-secondary-cyan flex flex-col">
                <h2 class="text-2xl font-semibold mb-4 text-secondary-cyan border-b pb-2">2. B·∫£ng Gi√° tr·ªã ($V$ & $P$ t·∫°i $T_{\text{current}}$)</h2>

                <div class="data-table-container bg-gray-50 rounded-lg p-2">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-secondary-cyan text-white sticky top-0">
                            <tr>
                                <th class="px-3 py-2 text-left text-xs font-medium uppercase tracking-wider rounded-tl-lg">L·∫ßn ƒëo</th>
                                <th class="px-3 py-2 text-left text-xs font-medium uppercase tracking-wider">T (K)</th>
                                <th class="px-3 py-2 text-left text-xs font-medium uppercase tracking-wider">Th·ªÉ t√≠ch $V$</th>
                                <th class="px-3 py-2 text-left text-xs font-medium uppercase tracking-wider rounded-tr-lg">√Åp su·∫•t $P$ (kPa)</th>
                            </tr>
                        </thead>
                        <tbody id="dataTableBody" class="bg-white divide-y divide-gray-200 text-gray-700 text-sm">
                            <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c ch√®n v√†o ƒë√¢y --></tbody>
                    </table>
                </div>

                <button id="clearDataButton"
                        class="mt-4 w-full bg-red-500 hover:bg-red-700 text-white font-bold py-2 rounded-xl transition duration-300 shadow-md text-sm">
                    X√≥a D·ªØ li·ªáu & ƒê·ªì th·ªã
                </button>
            </div>

            <!-- C·ªôt 3: ƒê·ªì th·ªã P theo V (So s√°nh ƒê·∫≥ng nhi·ªát) --><div class="bg-white p-6 rounded-xl shadow-2xl border-b-4 border-primary-teal flex flex-col">
                <h2 class="text-2xl font-semibold mb-4 text-primary-teal border-b pb-2">3. ƒê·ªì th·ªã $P$ theo $V$ (So s√°nh)</h2>

                <!-- Control for Comparison Temperature --><div class="mb-4 p-3 border rounded-lg">
                    <label for="tempCompareInput" class="block text-sm font-medium text-gray-700 mb-1">
                        So s√°nh v·ªõi ƒê∆∞·ªùng ƒë·∫≥ng nhi·ªát $T_{\text{comp}}$:
                    </label>
                    <input type="number" id="tempCompareInput" value="400" min="100" max="800" step="10"
                           class="w-full border border-gray-300 rounded-md shadow-sm p-2 text-center text-lg font-bold text-comparison-blue focus:ring-primary-teal focus:border-primary-teal"
                           onchange="updateChart()">
                    <p class="text-center text-xs text-gray-500 mt-1">Gi√° tr·ªã (K)</p>
                </div>

                <div class="flex-grow">
                    <canvas id="boyleChart"></canvas>
                </div>
                <!-- Ch√∫ th√≠ch ƒê·ªãnh lu·∫≠t --><div class="mt-4 p-3 bg-teal-50 border-l-4 border-primary-teal rounded-lg text-sm">
                    <p class="font-bold text-primary-teal">Nh·∫≠n x√©t:</p>
                    <p class="text-gray-700">ƒê∆∞·ªùng ƒë·∫≥ng nhi·ªát ·ª©ng v·ªõi nhi·ªát ƒë·ªô cao h∆°n (v√≠ d·ª• $400 \text{ K}$) s·∫Ω n·∫±m xa g·ªëc t·ªça ƒë·ªô h∆°n so v·ªõi ƒë∆∞·ªùng ƒë·∫≥ng nhi·ªát ·ª©ng v·ªõi nhi·ªát ƒë·ªô th·∫•p h∆°n ($300 \text{ K}$).</p>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- 1. H·∫±ng s·ªë v√† Bi·∫øn tr·∫°ng th√°i ---
        // Thi·∫øt l·∫≠p t·ªâ l·ªá tham chi·∫øu: P_ref * V_ref = C_ref t·∫°i T_ref
        const V_REF = 10.0;
        const P_REF = 100.0;
        const T_REF = 300.0;
        const C_REF = P_REF * V_REF; // 1000.0

        let currentTemperature = T_REF;
        let currentPVConstant = C_REF;
        let dataRecords = []; // M·∫£ng l∆∞u tr·ªØ c√°c ƒëi·ªÉm (V, P, T) ƒë√£ ghi l·∫°i
        let currentVolume = V_REF; // Th·ªÉ t√≠ch ban ƒë·∫ßu
        let currentPressure = P_REF; // √Åp su·∫•t ban ƒë·∫ßu

        // --- 2. Kh·ªüi t·∫°o DOM Elements ---
        const canvas = document.getElementById('simulationCanvas');
        const ctx = canvas.getContext('2d');
        const slider = document.getElementById('volumeSlider');
        const tempSlider = document.getElementById('tempSlider');
        const tempCompareInput = document.getElementById('tempCompareInput');
        const dataTableBody = document.getElementById('dataTableBody');
        const pressureDisplay = document.getElementById('pressureDisplay');
        const volumeDisplay = document.getElementById('volumeDisplay');
        const temperatureDisplay = document.getElementById('temperatureDisplay');
        const constantPV = document.getElementById('constantPV');
        const recordButton = document.getElementById('recordButton');
        const clearDataButton = document.getElementById('clearDataButton');

        let boyleChart;

        // --- 3. H√†m t√≠nh to√°n v·∫≠t l√Ω ---
        /**
         * T√≠nh √°p su·∫•t m·ªõi d·ª±a tr√™n th·ªÉ t√≠ch m·ªõi v√† h·∫±ng s·ªë PV hi·ªán t·∫°i
         * @param {number} volume - Th·ªÉ t√≠ch m·ªõi
         * @returns {number} √Åp su·∫•t m·ªõi (kPa)
         */
        function calculatePressure(volume, constant) {
            // P = C / V
            return constant / volume;
        }

        /**
         * C·∫≠p nh·∫≠t Nhi·ªát ƒë·ªô v√† H·∫±ng s·ªë PV
         */
        function updateTemperature() {
            currentTemperature = parseFloat(tempSlider.value);
            // C_new = C_ref * (T_new / T_ref)
            currentPVConstant = C_REF * (currentTemperature / T_REF);
            
            // C·∫≠p nh·∫≠t hi·ªÉn th·ªã Nhi·ªát ƒë·ªô
            temperatureDisplay.textContent = `${currentTemperature.toFixed(0)} K`;
            
            // C·∫≠p nh·∫≠t m√¥ ph·ªèng
            updateSimulation();
            
            // C·∫≠p nh·∫≠t ƒë·ªì th·ªã so s√°nh (v√¨ h·∫±ng s·ªë T current ƒë√£ thay ƒë·ªïi)
            updateChart();
        }

        // --- 4. H√†m v·∫Ω Xi lanh - Piston (C·ªôt 1) ---
        function drawSimulation() {
            // L·∫•y k√≠ch th∆∞·ªõc canvas th·ª±c t·∫ø
            const width = canvas.width;
            const height = canvas.height;
            ctx.clearRect(0, 0, width, height);

            // C·∫•u h√¨nh k√≠ch th∆∞·ªõc xi lanh
            const CYLINDER_WIDTH = width * 0.4;
            const CYLINDER_X = (width - CYLINDER_WIDTH) / 2;
            const CYLINDER_Y = height * 0.1;
            const CYLINDER_HEIGHT = height * 0.8;

            // T√≠nh to√°n v·ªã tr√≠ Piston d·ª±a tr√™n Th·ªÉ t√≠ch
            const minV = parseFloat(slider.min);
            const maxV = parseFloat(slider.max);
            const volumeRatio = (currentVolume - minV) / (maxV - minV);
            
            const PISTON_HEIGHT = 20;
            const PISTON_Y = CYLINDER_Y + CYLINDER_HEIGHT * (1 - volumeRatio) - PISTON_HEIGHT / 2;
            const GAS_HEIGHT = CYLINDER_Y + CYLINDER_HEIGHT - PISTON_Y;


            // 1. V·∫Ω Xi lanh (ƒê∆∞·ªùng vi·ªÅn)
            ctx.strokeStyle = '#00796b';
            ctx.lineWidth = 4;
            ctx.beginPath();
            // ƒê√°y
            ctx.moveTo(CYLINDER_X, CYLINDER_Y + CYLINDER_HEIGHT);
            ctx.lineTo(CYLINDER_X + CYLINDER_WIDTH, CYLINDER_Y + CYLINDER_HEIGHT);
            // Th√¢n
            ctx.moveTo(CYLINDER_X, CYLINDER_Y);
            ctx.lineTo(CYLINDER_X, CYLINDER_Y + CYLINDER_HEIGHT);
            ctx.moveTo(CYLINDER_X + CYLINDER_WIDTH, CYLINDER_Y);
            ctx.lineTo(CYLINDER_X + CYLINDER_WIDTH, CYLINDER_Y + CYLINDER_HEIGHT);
            ctx.stroke();

            // 2. V·∫Ω Kh√≠ (Gas). M√†u s·∫Øc ph·ª• thu·ªôc v√†o Nhi·ªát ƒë·ªô
            const tempRatio = (currentTemperature - 200) / (600 - 200); // 200K (min) ƒë·∫øn 600K (max)
            const red = Math.min(255, Math.floor(255 * tempRatio * 1.5)); // TƒÉng R khi T cao
            const blue = Math.max(0, Math.floor(255 * (1 - tempRatio * 1.5))); // Gi·∫£m B khi T cao
            ctx.fillStyle = `rgba(${red}, 100, ${blue}, 0.7)`; // Chuy·ªÉn m√†u t·ª´ Xanh sang ƒê·ªè
            ctx.fillRect(CYLINDER_X + 2, PISTON_Y + PISTON_HEIGHT, CYLINDER_WIDTH - 4, GAS_HEIGHT - PISTON_HEIGHT);

            // 3. V·∫Ω Piston
            ctx.fillStyle = '#4a5568'; // M√†u x√°m ƒë·∫≠m
            ctx.strokeStyle = '#2d3748';
            ctx.lineWidth = 2;
            ctx.fillRect(CYLINDER_X - 5, PISTON_Y, CYLINDER_WIDTH + 10, PISTON_HEIGHT);
            ctx.strokeRect(CYLINDER_X - 5, PISTON_Y, CYLINDER_WIDTH + 10, PISTON_HEIGHT);


            // 4. V·∫Ω Thanh Piston (C·∫ßn ƒë·∫©y)
            const ROD_WIDTH = 8;
            ctx.fillStyle = '#a0aec0';
            ctx.fillRect(CYLINDER_X + CYLINDER_WIDTH / 2 - ROD_WIDTH / 2, 0, ROD_WIDTH, PISTON_Y);

            // 5. Th∆∞·ªõc ƒëo Th·ªÉ t√≠ch (V)
            ctx.fillStyle = 'blue';
            ctx.font = '14px Arial';
            ctx.fillText(`V = ${currentVolume.toFixed(1)}`, CYLINDER_X + CYLINDER_WIDTH + 10, PISTON_Y + PISTON_HEIGHT / 2 + 5);

            // 6. M√¥ ph·ªèng √Åp su·∫•t (P)
            // L·ªói "Identifier 'minV' has already been declared" ƒë√£ ƒë∆∞·ª£c s·ª≠a ·ªü ƒë√¢y.
            // minV ƒë∆∞·ª£c khai b√°o ·ªü tr√™n, gi·ªù ch·ªâ c·∫ßn s·ª≠ d·ª•ng n√≥.
            const maxP_at_Tcurrent = currentPVConstant / minV; // √Åp su·∫•t t·ªëi ƒëa hi·ªán t·∫°i
            const pressureRatio = currentPressure / maxP_at_Tcurrent;
            const GAUGE_X = CYLINDER_X - 40;
            const GAUGE_Y = CYLINDER_Y + CYLINDER_HEIGHT / 2;
            const GAUGE_LENGTH = 50;

            // Thanh √°p k·∫ø
            ctx.strokeStyle = '#888';
            ctx.lineWidth = 8;
            ctx.beginPath();
            ctx.moveTo(GAUGE_X, GAUGE_Y - GAUGE_LENGTH);
            ctx.lineTo(GAUGE_X, GAUGE_Y + GAUGE_LENGTH);
            ctx.stroke();

            // Kim/Thanh hi·ªÉn th·ªã √°p su·∫•t
            ctx.fillStyle = 'red';
            const P_BAR_LENGTH = GAUGE_LENGTH * 2 * pressureRatio;
            ctx.fillRect(GAUGE_X - 8, GAUGE_Y + GAUGE_LENGTH - P_BAR_LENGTH, 16, P_BAR_LENGTH);

            // Ch·ªâ s·ªë P
            ctx.fillStyle = 'red';
            ctx.font = '14px Arial';
            ctx.fillText(`P: ${currentPressure.toFixed(1)}`, GAUGE_X - 10, GAUGE_Y - GAUGE_LENGTH - 10);
        }

        // --- 5. H√†m c·∫≠p nh·∫≠t giao di·ªán (P, V) v√† V·∫Ω l·∫°i ---
        function updateSimulation() {
            currentVolume = parseFloat(slider.value);
            currentPressure = calculatePressure(currentVolume, currentPVConstant);

            // C·∫≠p nh·∫≠t hi·ªÉn th·ªã s·ªë
            pressureDisplay.textContent = `${currentPressure.toFixed(2)} kPa`;
            volumeDisplay.textContent = `${currentVolume.toFixed(1)} ƒë∆°n v·ªã`;
            constantPV.textContent = `${(currentPressure * currentVolume).toFixed(1)}`;

            // V·∫Ω l·∫°i m√¥ ph·ªèng
            drawSimulation();
        }

        // --- 6. H√†m x·ª≠ l√Ω B·∫£ng gi√° tr·ªã (C·ªôt 2) ---
        function updateDataTable() {
            dataTableBody.innerHTML = ''; // X√≥a b·∫£ng c≈©
            dataRecords.forEach((record, index) => {
                const row = dataTableBody.insertRow();
                row.className = 'hover:bg-teal-50 transition duration-150';

                // C·ªôt L·∫ßn ƒëo
                let cell1 = row.insertCell();
                cell1.className = 'px-3 py-2 whitespace-nowrap text-center';
                cell1.textContent = index + 1;
                
                // C·ªôt Nhi·ªát ƒë·ªô T
                let cell2 = row.insertCell();
                cell2.className = 'px-3 py-2 whitespace-nowrap font-medium text-green-600';
                cell2.textContent = record.T.toFixed(0);

                // C·ªôt Th·ªÉ t√≠ch V
                let cell3 = row.insertCell();
                cell3.className = 'px-3 py-2 whitespace-nowrap font-medium text-blue-600';
                cell3.textContent = record.V.toFixed(1);

                // C·ªôt √Åp su·∫•t P
                let cell4 = row.insertCell();
                cell4.className = 'px-3 py-2 whitespace-nowrap font-medium text-red-600';
                cell4.textContent = record.P.toFixed(2);
            });
        }

        // --- 7. H√†m x·ª≠ l√Ω ƒê·ªì th·ªã (C·ªôt 3) ---
        function initializeChart() {
            const ctxChart = document.getElementById('boyleChart').getContext('2d');
            boyleChart = new Chart(ctxChart, {
                type: 'line',
                data: {
                    datasets: [{
                        label: `D·ªØ li·ªáu Th·ª±c nghi·ªám (T = ${currentTemperature.toFixed(0)} K)`,
                        data: [],
                        borderColor: '#e53e3e',
                        backgroundColor: 'rgba(229, 62, 62, 0.1)',
                        tension: 0.4, 
                        pointRadius: 0, // ƒê√£ thay ƒë·ªïi: ·∫©n c√°c ch·∫•m tr√≤n
                        pointHoverRadius: 4, // V·∫´n c√≥ th·ªÉ highlight khi hover
                        pointBackgroundColor: '#e53e3e',
                        showLine: true, // ƒê√£ thay ƒë·ªïi: hi·ªÉn th·ªã ƒë∆∞·ªùng n·ªëi
                        borderWidth: 2 // ƒê√£ thay ƒë·ªïi: l√†m ƒë∆∞·ªùng m·∫£nh h∆°n
                    },
                    {
                        label: `ƒê·∫≥ng nhi·ªát So s√°nh (T = ${tempCompareInput.value} K) - L√Ω thuy·∫øt`,
                        data: [],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderDash: [5, 5], // ƒê∆∞·ªùng ƒë·ª©t n√©t
                        tension: 0.6,
                        pointRadius: 0,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true, position: 'top' },
                        title: {
                            display: true,
                            text: 'ƒê·ªì th·ªã √Åp su·∫•t (P) theo Th·ªÉ t√≠ch (V)',
                            font: { size: 16 }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Th·ªÉ t√≠ch V (ƒë∆°n v·ªã)',
                                font: { weight: 'bold' }
                            },
                            type: 'linear',
                            min: 0,
                            max: 22
                        },
                        y: {
                            title: {
                                display: true,
                                text: '√Åp su·∫•t P (kPa)',
                                font: { weight: 'bold' }
                            },
                            type: 'linear',
                            min: 0,
                            max: 220 // Ph√π h·ª£p v·ªõi max T (600K) v√† min V (5)
                        }
                    }
                }
            });
            updateComparisonCurve();
        }

        // H√†m t·∫°o ƒë∆∞·ªùng cong l√Ω thuy·∫øt
        function generateIsothermData(T) {
            const constant = C_REF * (T / T_REF);
            const data = [];
            for (let V = parseFloat(slider.min); V <= parseFloat(slider.max) + 5; V += 0.5) {
                 if (V > 0) {
                    data.push({ x: V, y: constant / V });
                }
            }
            return data;
        }

        // C·∫≠p nh·∫≠t ƒë∆∞·ªùng cong so s√°nh v√† d·ªØ li·ªáu th·ª±c nghi·ªám
        function updateChart() {
            const T_comp = parseFloat(tempCompareInput.value) || T_REF; // ƒê·∫£m b·∫£o l√† s·ªë
            const T_current = currentTemperature;

            // 1. C·∫≠p nh·∫≠t D·ªØ li·ªáu Th·ª±c nghi·ªám (Ch·∫•m ƒë·ªè)
            const chartData = dataRecords
                .filter(record => record.T === T_current) // Ch·ªâ l·∫•y c√°c ƒëi·ªÉm c√≥ T_current hi·ªán t·∫°i
                .map(record => ({ x: record.V, y: record.P }));

            boyleChart.data.datasets[0].data = chartData;
            boyleChart.data.datasets[0].label = `D·ªØ li·ªáu Th·ª±c nghi·ªám (T = ${T_current.toFixed(0)} K)`;

            // 2. C·∫≠p nh·∫≠t ƒê∆∞·ªùng cong So s√°nh (ƒê∆∞·ªùng xanh)
            const compData = generateIsothermData(T_comp);
            
            boyleChart.data.datasets[1].data = compData;
            boyleChart.data.datasets[1].label = `ƒê·∫≥ng nhi·ªát So s√°nh (T = ${T_comp.toFixed(0)} K) - L√Ω thuy·∫øt`;

            boyleChart.update();
        }

        function updateComparisonCurve() {
            updateChart();
        }

        // --- 8. H√†m s·ª± ki·ªán ch√≠nh ---
        function recordData() {
            // L·∫•y gi√° tr·ªã hi·ªán t·∫°i
            const V = currentVolume;
            const P = currentPressure;
            const T = currentTemperature;

            // Th√™m v√†o m·∫£ng (kh√¥ng c·∫ßn ki·ªÉm tra tr√πng l·∫∑p v√¨ c√≥ th·ªÉ ghi nhi·ªÅu ƒëi·ªÉm ·ªü c√πng V nh∆∞ng T kh√°c)
            dataRecords.push({ V, P, T });
            
            // S·∫Øp x·∫øp theo V tƒÉng d·∫ßn (ƒë·ªÉ ƒë·∫£m b·∫£o th·ª© t·ª± hi·ªÉn th·ªã)
            dataRecords.sort((a, b) => a.V - b.V);
            
            // C·∫≠p nh·∫≠t B·∫£ng v√† ƒê·ªì th·ªã
            updateDataTable();
            updateChart();
        }

        function clearData() {
            // S·ª≠ d·ª•ng confirm custom
            showModal("X√°c nh·∫≠n", "B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a t·∫•t c·∫£ d·ªØ li·ªáu th·ª±c nghi·ªám v√† ƒë·ªì th·ªã kh√¥ng?", () => {
                dataRecords = [];
                updateDataTable();
                updateChart();
            });
        }

        // --- 9. Kh·ªüi t·∫°o v√† G·∫Øn s·ª± ki·ªán ---
        window.onload = function() {
            // ƒê·∫∑t k√≠ch th∆∞·ªõc Canvas sau khi DOM load
            canvas.width = canvas.clientWidth;
            canvas.height = canvas.clientHeight;

            // Kh·ªüi t·∫°o ƒë·ªì th·ªã
            initializeChart();

            // Kh·ªüi t·∫°o tr·∫°ng th√°i m√¥ ph·ªèng ban ƒë·∫ßu
            updateTemperature(); // C·∫≠p nh·∫≠t T v√† C
            updateSimulation();

            // G·∫Øn s·ª± ki·ªán cho Slider Th·ªÉ t√≠ch
            slider.addEventListener('input', updateSimulation);
            
            // G·∫Øn s·ª± ki·ªán cho Slider Nhi·ªát ƒë·ªô (H√†m updateTemperature ƒë√£ c√≥ s·∫µn)
            // tempSlider.addEventListener('input', updateTemperature);

            // G·∫Øn s·ª± ki·ªán cho Input Nhi·ªát ƒë·ªô So s√°nh
            tempCompareInput.addEventListener('change', updateComparisonCurve);

            // G·∫Øn s·ª± ki·ªán cho N√∫t ghi l·∫°i
            recordButton.addEventListener('click', recordData);

            // G·∫Øn s·ª± ki·ªán cho N√∫t x√≥a d·ªØ li·ªáu
            clearDataButton.addEventListener('click', clearData);
        }

        // X·ª≠ l√Ω khi c·ª≠a s·ªï resize ƒë·ªÉ canvas v·∫Ω l·∫°i ƒë√∫ng k√≠ch th∆∞·ªõc
        window.addEventListener('resize', () => {
             // ƒê·∫∑t k√≠ch th∆∞·ªõc Canvas sau khi DOM load
            canvas.width = canvas.clientWidth;
            canvas.height = canvas.clientHeight;
            // V·∫Ω l·∫°i m√¥ ph·ªèng
            drawSimulation();
            // C·∫≠p nh·∫≠t ƒë·ªì th·ªã ƒë·ªÉ n√≥ thay ƒë·ªïi k√≠ch th∆∞·ªõc theo container
            boyleChart.resize();
        });

        // H√†m thay th·∫ø alert/confirm ƒë·ªÉ tr√°nh l·ªói iFrame
        function showModal(title, message, callback) {
            // N·∫øu c√≥ callback, ƒë√¢y l√† confirm. N·∫øu kh√¥ng, l√† alert.
            const isConfirm = !!callback; 
            const existingModal = document.querySelector('.fixed.inset-0.bg-gray-600');
            if (existingModal) existingModal.remove();

            const container = document.createElement('div');
            container.className = 'fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-50 transition-opacity duration-300';
            container.innerHTML = `
                <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full transform transition-transform duration-300 scale-95 opacity-0">
                    <h3 class="text-xl font-bold ${isConfirm ? 'text-red-600' : 'text-primary-teal'} mb-4 border-b pb-2">${title}</h3>
                    <p class="text-gray-700 mb-6">${message}</p>
                    <div class="flex ${isConfirm ? 'justify-between' : 'justify-center'} space-x-4">
                        ${isConfirm ? `
                            <button id="modalConfirm" class="w-1/2 bg-red-500 hover:bg-red-700 text-white font-bold py-2 rounded transition duration-300">X√°c nh·∫≠n</button>
                            <button id="modalCancel" class="w-1/2 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 rounded transition duration-300">H·ªßy</button>
                        ` : `
                            <button id="modalClose" class="w-full bg-primary-teal hover:bg-teal-700 text-white font-bold py-2 rounded transition duration-300">ƒê√≥ng</button>
                        `}
                    </div>
                </div>
            `;
            document.body.appendChild(container);

            // Hi·ªáu ·ª©ng Fade in
            setTimeout(() => {
                container.querySelector('div').classList.remove('scale-95', 'opacity-0');
                container.querySelector('div').classList.add('scale-100', 'opacity-100');
            }, 10);

            if (isConfirm) {
                document.getElementById('modalConfirm').onclick = () => {
                    container.remove();
                    callback();
                };
                document.getElementById('modalCancel').onclick = () => {
                    container.remove();
                };
            } else {
                document.getElementById('modalClose').onclick = () => {
                    container.remove();
                };
            }
        }
        
        // Thay th·∫ø h√†m alert m·∫∑c ƒë·ªãnh b·∫±ng modal
        window.alert = (message) => showModal("Th√¥ng B√°o", message);
        // Thay th·∫ø h√†m confirm m·∫∑c ƒë·ªãnh b·∫±ng modal
        window.confirm = (message) => { 
            console.warn("Using showModal instead of native confirm.");
            // Native confirm is synchronous, but we can't do that here. 
            // The clearData function has been modified to use showModal directly.
            // This placeholder is just to prevent other code (like the clearData function) from calling the native confirm.
        };
    </script>
</body>
</html>
