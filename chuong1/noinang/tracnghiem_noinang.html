<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr·∫Øc Nghi·ªám V·∫≠t L√Ω: N·ªôi nƒÉng & Nguy√™n l√Ω I Nhi·ªát ƒë·ªông l·ª±c h·ªçc</title>
    <!-- T·∫£i Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- T·∫£i font Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- KH·ªêI C·∫§U H√åNH MATHJAX M·ªöI -->
    <script>
        // C·∫•u h√¨nh MathJax ƒë·ªÉ cho ph√©p s·ª≠ d·ª•ng d·∫•u $ cho c√¥ng th·ª©c inline
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']], // Th√™m '$' cho inline math
                displayMath: [['$$', '$$'], ['\\[', '\\]']] // Gi·ªØ nguy√™n cho display math
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    
    <!-- T·∫£i MathJax ƒë·ªÉ render c√¥ng th·ª©c LaTeX -->
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        /* Thi·∫øt l·∫≠p font Inter m·∫∑c ƒë·ªãnh */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
            /* ƒê·∫£m b·∫£o n·ªôi dung chung l√† font-normal/m·∫£nh */
            font-weight: 400; 
        }
        /* Style cho n√∫t c√¢u h·ªèi ƒë√£ tr·∫£ l·ªùi */
        .question-nav-button.answered {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        .question-nav-button.correct {
            background-color: #10b981;
            color: white;
            border-color: #10b981;
        }
        .question-nav-button.incorrect {
            background-color: #ef4444;
            color: white;
            border-color: #ef4444;
        }
        /* Animation cho n√∫t ƒë∆∞·ª£c ch·ªçn */
        .option-item:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2p x rgba(0, 0, 0, 0.1);
        }
        .selected-option {
            border: 3px solid #3b82f6; /* M√†u xanh d∆∞∆°ng n·ªïi b·∫≠t khi ch·ªçn */
            background-color: #eff6ff; /* N·ªÅn xanh nh·∫°t */
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.3), 0 4px 6px -4px rgba(59, 130, 246, 0.1);
        }
        .correct-answer {
            border: 3px solid #10b981; /* M√†u xanh l√° c√¢y khi ƒë√∫ng */
            background-color: #d1fae5;
        }
        .incorrect-answer {
            border: 3px solid #ef4444; /* M√†u ƒë·ªè khi sai */
            background-color: #fee2e2;
        }
        .answer-label {
            min-width: 32px;
            display: flex;
            justify-content: center;
            align-items: center;
            /* Gi·ªØ ƒë·ªô ƒë·∫≠m cho nh√£n A/B/C/D ƒë·ªÉ n·ªïi b·∫≠t */
            font-weight: 600; 
        }
        /* Custom modal animation */
        .modal {
            transition: opacity 0.3s ease-in-out;
        }
        /* ƒêi·ªÅu ch·ªânh k√≠ch th∆∞·ªõc c√¥ng th·ª©c ƒë·ªÉ kh√¥ng b·ªã tr√†n */
        .MathJax {
             overflow-x: auto;
             max-width: 100%;
        }
    </style>
</head>
<body class="min-h-screen antialiased">

    <!-- Toast Notification (C·ªï v≈©/ƒê·ªông vi√™n) -->
    <div id="toast-container" class="fixed top-5 right-5 z-50 space-y-2">
        <!-- Toasts will be injected here -->
    </div>

    <!-- Main Application Container -->
    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-10">
            <!-- Ti√™u ƒë·ªÅ v·∫´n gi·ªØ bold -->
            <h1 class="text-3xl font-bold text-blue-700">√îN T·∫¨P V·∫¨T L√ù 12</h1>
            <p class="mt-2 text-xl text-gray-600 font-normal">N·ªôi nƒÉng v√† Nguy√™n l√Ω I Nhi·ªát ƒë·ªông l·ª±c h·ªçc</p>
            <p class="text-sm italic text-gray-500 mt-1 font-normal">20 c√¢u h·ªèi ph√¢n lo·∫°i theo 4 tr√¨nh ƒë·ªô nh·∫≠n th·ª©c</p>
        </header>

        <!-- LAYOUT CH√çNH: Flex-col tr√™n mobile (Content tr√™n, Sidebar d∆∞·ªõi), Flex-row tr√™n m√†n h√¨nh l·ªõn (Content tr√°i, Sidebar ph·∫£i) -->
        <main id="quiz-app" class="flex flex-col lg:flex-row gap-8">
            
            <!-- Quiz Content Area (B√¢y gi·ªù n·∫±m ·ªü V·ªä TR√ç ƒê·∫¶U TI√äN trong HTML) -->
            <div id="content-area" class="flex-grow bg-white p-6 md:p-8 rounded-xl shadow-lg">
                <!-- Question and Results views will be rendered here -->
            </div>
            
            <!-- Question Navigation Sidebar (B√¢y gi·ªù n·∫±m ·ªü V·ªä TR√ç TH·ª® HAI trong HTML) -->
            <!-- Sticky top-8 gi·ªØ sidebar c·ªë ƒë·ªãnh khi cu·ªôn tr√™n m√†n h√¨nh l·ªõn -->
            <div id="sidebar" class="w-full lg:w-64 bg-white p-4 rounded-xl shadow-lg h-fit lg:sticky top-8">
                <h2 class="text-lg font-semibold mb-4 border-b pb-2 text-gray-700">Thanh ƒëi·ªÅu h∆∞·ªõng</h2>
                <div id="question-nav" class="grid grid-cols-5 gap-3 sm:grid-cols-7 lg:grid-cols-4 xl:grid-cols-5">
                    <!-- Navigation buttons will be injected here -->
                </div>
                <button id="submit-quiz-button" onclick="showResults()" class="mt-6 w-full py-3 bg-red-500 text-white font-bold rounded-lg hover:bg-red-600 transition duration-300 shadow-md focus:outline-none focus:ring-4 focus:ring-red-300">
                    N·ªôp b√†i & Xem k·∫øt qu·∫£
                </button>
            </div>

        </main>
    </div>

    <script>
        // --- 1. QUIZ DATA ---
        const rawQuestions = [
            // C·∫•p ƒë·ªô 1: Ghi nh·ªõ (5 c√¢u)
            { id: 1, level: "Ghi nh·ªõ", question: "N·ªôi nƒÉng c·ªßa m·ªôt v·∫≠t (h·ªá) l√†:", options: ["T·ªïng ƒë·ªông nƒÉng v√† th·∫ø nƒÉng c·ªßa v·∫≠t.", "T·ªïng ƒë·ªông nƒÉng c·ªßa c√°c ph√¢n t·ª≠ c·∫•u t·∫°o n√™n v·∫≠t.", "T·ªïng ƒë·ªông nƒÉng v√† th·∫ø nƒÉng t∆∞∆°ng t√°c c·ªßa c√°c ph√¢n t·ª≠ c·∫•u t·∫°o n√™n v·∫≠t.", "Nhi·ªát l∆∞·ª£ng v·∫≠t nh·∫≠n ƒë∆∞·ª£c trong m·ªôt qu√° tr√¨nh."], correctIndex: 2, explanation: "N·ªôi nƒÉng l√† t·ªïng ƒë·ªông nƒÉng chuy·ªÉn ƒë·ªông nhi·ªát v√† th·∫ø nƒÉng t∆∞∆°ng t√°c c·ªßa c√°c ph√¢n t·ª≠ c·∫•u t·∫°o n√™n v·∫≠t. C√¥ng th·ª©c: $\\Delta U = \\sum E_{d} + \\sum E_{t}$.", },
            { id: 2, level: "Ghi nh·ªõ", question: "Trong c√¥ng th·ª©c c·ªßa nguy√™n l√≠ I nhi·ªát ƒë·ªông l·ª±c h·ªçc, khi v·∫≠t nh·∫≠n c√¥ng ($A > 0$), ƒëi·ªÅu ƒë√≥ c√≥ nghƒ©a l√†:", options: ["V·∫≠t sinh c√¥ng cho m√¥i tr∆∞·ªùng ngo√†i.", "V·∫≠t nh·∫≠n nhi·ªát l∆∞·ª£ng.", "M√¥i tr∆∞·ªùng ngo√†i th·ª±c hi·ªán c√¥ng l√™n v·∫≠t.", "N·ªôi nƒÉng c·ªßa v·∫≠t gi·∫£m."], correctIndex: 2, explanation: "Theo quy ∆∞·ªõc, $A > 0$ khi c√¥ng ƒë∆∞·ª£c th·ª±c hi·ªán b·ªüi m√¥i tr∆∞·ªùng ngo√†i l√™n h·ªá (h·ªá nh·∫≠n c√¥ng). C√¥ng th·ª©c: $\\Delta U = Q + A$.", },
            { id: 3, level: "Ghi nh·ªõ", question: "N·ªôi nƒÉng c·ªßa m·ªôt kh·ªëi kh√≠ l√≠ t∆∞·ªüng ch·ªâ ph·ª• thu·ªôc v√†o y·∫øu t·ªë n√†o?", options: ["√Åp su·∫•t v√† th·ªÉ t√≠ch.", "√Åp su·∫•t v√† nhi·ªát ƒë·ªô.", "Th·ªÉ t√≠ch v√† nhi·ªát ƒë·ªô.", "Nhi·ªát ƒë·ªô."], correctIndex: 3, explanation: "Kh√≠ l√≠ t∆∞·ªüng kh√¥ng c√≥ th·∫ø nƒÉng t∆∞∆°ng t√°c gi·ªØa c√°c ph√¢n t·ª≠, do ƒë√≥ n·ªôi nƒÉng ch·ªâ l√† t·ªïng ƒë·ªông nƒÉng c·ªßa c√°c ph√¢n t·ª≠, v√† ƒë·ªông nƒÉng n√†y ch·ªâ ph·ª• thu·ªôc v√†o nhi·ªát ƒë·ªô tuy·ªát ƒë·ªëi ($T$).", },
            { id: 4, level: "Ghi nh·ªõ", question: "Nguy√™n l√≠ I nhi·ªát ƒë·ªông l·ª±c h·ªçc l√† s·ª± ph√°t bi·ªÉu c·ªßa ƒë·ªãnh lu·∫≠t b·∫£o to√†n v√† chuy·ªÉn h√≥a nƒÉng l∆∞·ª£ng √°p d·ª•ng cho:", options: ["Qu√° tr√¨nh trao ƒë·ªïi nhi·ªát.", "Qu√° tr√¨nh truy·ªÅn c√¥ng.", "C√°c hi·ªán t∆∞·ª£ng c∆° h·ªçc.", "S·ª± bi·∫øn thi√™n n·ªôi nƒÉng c·ªßa v·∫≠t."], correctIndex: 3, explanation: "Nguy√™n l√≠ I nhi·ªát ƒë·ªông l·ª±c h·ªçc ph√°t bi·ªÉu: ƒê·ªô bi·∫øn thi√™n n·ªôi nƒÉng ($\\Delta U$) c·ªßa m·ªôt v·∫≠t b·∫±ng t·ªïng nhi·ªát l∆∞·ª£ng ($Q$) v√† c√¥ng ($A$) m√† v·∫≠t nh·∫≠n ƒë∆∞·ª£c: $\\Delta U = Q + A$.", },
            { id: 5, level: "Ghi nh·ªõ", question: "ƒê·∫°i l∆∞·ª£ng n√†o sau ƒë√¢y l√† s·ªë ƒëo ƒë·ªô bi·∫øn thi√™n n·ªôi nƒÉng c·ªßa h·ªá trong qu√° tr√¨nh truy·ªÅn nhi·ªát?", options: ["C√¥ng.", "Nhi·ªát l∆∞·ª£ng.", "Nhi·ªát dung ri√™ng.", "Th·∫ø nƒÉng."], correctIndex: 1, explanation: "Trong qu√° tr√¨nh truy·ªÅn nhi·ªát thu·∫ßn t√∫y (kh√¥ng th·ª±c hi·ªán c√¥ng, $A=0$), c√¥ng th·ª©c $\\Delta U = Q + A$ tr·ªü th√†nh $\\Delta U = Q$. Nhi·ªát l∆∞·ª£ng ($Q$) ch√≠nh l√† s·ªë ƒëo ƒë·ªô bi·∫øn thi√™n n·ªôi nƒÉng.", },

            // C·∫•p ƒë·ªô 2: Hi·ªÉu (5 c√¢u)
            { id: 6, level: "Hi·ªÉu", question: "Trong qu√° tr√¨nh ƒëo·∫°n nhi·ªát, v·∫≠t trao ƒë·ªïi nhi·ªát v·ªõi m√¥i tr∆∞·ªùng nh∆∞ th·∫ø n√†o?", options: ["V·∫≠t nh·∫≠n nhi·ªát l∆∞·ª£ng $Q > 0$.", "V·∫≠t truy·ªÅn nhi·ªát l∆∞·ª£ng $Q < 0$.", "V·∫≠t kh√¥ng trao ƒë·ªïi nhi·ªát v·ªõi m√¥i tr∆∞·ªùng ($Q = 0$).", "V·∫≠t nh·∫≠n nhi·ªát l∆∞·ª£ng ƒë√∫ng b·∫±ng c√¥ng th·ª±c hi·ªán $Q = A$.",], correctIndex: 2, explanation: "Qu√° tr√¨nh ƒëo·∫°n nhi·ªát l√† qu√° tr√¨nh x·∫£y ra nhanh ƒë·∫øn m·ª©c kh√¥ng k·ªãp trao ƒë·ªïi nhi·ªát, ho·∫∑c h·ªá ƒë∆∞·ª£c c√°ch nhi·ªát ho√†n to√†n. Do ƒë√≥ $Q = 0$.", },
            { id: 7, level: "Hi·ªÉu", question: "ƒêun n√≥ng m·ªôt kh·ªëi kh√≠ trong b√¨nh k√≠n (qu√° tr√¨nh ƒë·∫≥ng t√≠ch), √°p su·∫•t v√† n·ªôi nƒÉng c·ªßa kh·ªëi kh√≠ s·∫Ω thay ƒë·ªïi nh∆∞ th·∫ø n√†o?", options: ["√Åp su·∫•t tƒÉng, n·ªôi nƒÉng gi·∫£m.", "√Åp su·∫•t kh√¥ng ƒë·ªïi, n·ªôi nƒÉng tƒÉng.", "√Åp su·∫•t tƒÉng, n·ªôi nƒÉng tƒÉng.", "√Åp su·∫•t gi·∫£m, n·ªôi nƒÉng gi·∫£m."], correctIndex: 2, explanation: "ƒêun n√≥ng ($T$ tƒÉng). Qu√° tr√¨nh ƒë·∫≥ng t√≠ch ($V=\\text{const}$), theo ƒë·ªãnh lu·∫≠t Sac-l∆° $P/T=\\text{const}$ n√™n $T$ tƒÉng $\\implies P$ tƒÉng. N·ªôi nƒÉng kh√≠ l√≠ t∆∞·ªüng ph·ª• thu·ªôc v√†o $T$, n√™n $T$ tƒÉng $\\implies U$ tƒÉng.", },
            { id: 8, level: "Hi·ªÉu", question: "Trong qu√° tr√¨nh ƒë·∫≥ng nhi·ªát c·ªßa kh√≠ l√≠ t∆∞·ªüng, c√¥ng ($A$) m√† m√¥i tr∆∞·ªùng th·ª±c hi·ªán l√™n kh√≠ v√† nhi·ªát l∆∞·ª£ng ($Q$) kh√≠ nh·∫≠n v√†o c√≥ m·ªëi li√™n h·ªá nh∆∞ th·∫ø n√†o?", options: ["$A = 0$ v√† $Q = \\Delta U$.", "$A = -Q$.", "$Q = 0$ v√† $\\Delta U = A$.", "$Q = A$."], correctIndex: 1, explanation: "Qu√° tr√¨nh ƒë·∫≥ng nhi·ªát ($T=\\text{const}$) c·ªßa kh√≠ l√≠ t∆∞·ªüng $\\implies \\Delta U = 0$. √Åp d·ª•ng Nguy√™n l√≠ I: $\\Delta U = Q + A \\implies 0 = Q + A \\implies A = -Q$.", },
            { id: 9, level: "Hi·ªÉu", question: "Khi ta khu·∫•y m·ªôt c·ªëc n∆∞·ªõc l·∫°nh, n·ªôi nƒÉng c·ªßa n∆∞·ªõc thay ƒë·ªïi nh∆∞ th·∫ø n√†o v√† nguy√™n nh√¢n ch√≠nh l√† g√¨?", options: ["N·ªôi nƒÉng gi·∫£m do n∆∞·ªõc truy·ªÅn nhi·ªát ra kh√¥ng kh√≠.", "N·ªôi nƒÉng kh√¥ng ƒë·ªïi v√¨ kh√¥ng c√≥ s·ª± truy·ªÅn nhi·ªát r√µ r·ªát.", "N·ªôi nƒÉng tƒÉng do ta th·ª±c hi·ªán c√¥ng l√™n n∆∞·ªõc.", "N·ªôi nƒÉng tƒÉng do ta cung c·∫•p nhi·ªát l∆∞·ª£ng cho n∆∞·ªõc."], correctIndex: 2, explanation: "Khu·∫•y n∆∞·ªõc l√† ta th·ª±c hi·ªán c√¥ng ($A > 0$) l√™n h·ªá. Theo $\\Delta U = Q + A$, n·∫øu b·ªè qua s·ª± truy·ªÅn nhi·ªát ra m√¥i tr∆∞·ªùng ($Q \\approx 0$), th√¨ $\\Delta U = A > 0$, n·ªôi nƒÉng tƒÉng l√™n.", },
            { id: 10, level: "Hi·ªÉu", question: "N·ªôi nƒÉng c·ªßa m·ªôt l∆∞·ª£ng n∆∞·ªõc kh√¥ng thay ƒë·ªïi khi n√†o?", options: ["N∆∞·ªõc ƒë∆∞·ª£c l√†m l·∫°nh t·ª´ $50^{\\circ}$C xu·ªëng $20^{\\circ}$C.", "N∆∞·ªõc ƒë∆∞·ª£c ƒëun n√≥ng t·ª´ $20^{\\circ}$C l√™n $50^{\\circ}$C.", "N∆∞·ªõc ƒë∆∞·ª£c chuy·ªÉn t·ª´ c·ªëc n√†y sang c·ªëc kh√°c m√† kh√¥ng thay ƒë·ªïi nhi·ªát ƒë·ªô.", "N∆∞·ªõc ƒë∆∞·ª£c n√©n t·ª´ √°p su·∫•t $1\\text{ atm}$ l√™n $2\\text{ atm}$ ·ªü nhi·ªát ƒë·ªô kh√¥ng ƒë·ªïi."], correctIndex: 2, explanation: "N·ªôi nƒÉng c·ªßa ch·∫•t l·ªèng ph·ª• thu·ªôc ch·ªß y·∫øu v√†o nhi·ªát ƒë·ªô. Ch·ªâ khi nhi·ªát ƒë·ªô kh√¥ng thay ƒë·ªïi th√¨ n·ªôi nƒÉng m·ªõi kh√¥ng ƒë·ªïi. Vi·ªác chuy·ªÉn t·ª´ c·ªëc n√†y sang c·ªëc kh√°c kh√¥ng l√†m thay ƒë·ªïi nhi·ªát ƒë·ªô.", },

            // C·∫•p ƒë·ªô 3: V·∫≠n d·ª•ng th·∫•p (5 c√¢u)
            { id: 11, level: "V·∫≠n d·ª•ng th·∫•p", question: "M·ªôt kh·ªëi kh√≠ nh·∫≠n nhi·ªát l∆∞·ª£ng $Q = 150\\text{ J}$, ƒë·ªìng th·ªùi kh√≠ th·ª±c hi·ªán c√¥ng $A' = 40\\text{ J}$. ƒê·ªô bi·∫øn thi√™n n·ªôi nƒÉng $\\Delta U$ c·ªßa kh√≠ l√†:", options: ["$190\\text{ J}$", "$110\\text{ J}$", "$-110\\text{ J}$", "$-190\\text{ J}$"], correctIndex: 1, explanation: "Kh√≠ nh·∫≠n nhi·ªát: $Q = 150\\text{ J}$. Kh√≠ th·ª±c hi·ªán c√¥ng: $A' = 40\\text{ J} \\implies$ C√¥ng m√¥i tr∆∞·ªùng th·ª±c hi·ªán l√™n kh√≠: $A = -A' = -40\\text{ J}$. √Åp d·ª•ng Nguy√™n l√≠ I: $\\Delta U = Q + A = 150 + (-40) = 110\\text{ J}$.", },
            { id: 12, level: "V·∫≠n d·ª•ng th·∫•p", question: "M·ªôt kh·ªëi kh√≠ gi√£n n·ªü ƒë·∫≥ng √°p d∆∞·ªõi √°p su·∫•t $P = 1,5 \\times 10^5\\text{ Pa}$. Th·ªÉ t√≠ch kh√≠ tƒÉng t·ª´ $V_1 = 2,0\\text{ L}$ ƒë·∫øn $V_2 = 5,0\\text{ L}$. C√¥ng $A'$ m√† kh·ªëi kh√≠ th·ª±c hi·ªán l√† bao nhi√™u?", options: ["$450\\text{ J}$", "$300\\text{ J}$", "$750\\text{ J}$", "$-450\\text{ J}$"], correctIndex: 0, explanation: "C√¥ng kh√≠ th·ª±c hi·ªán trong qu√° tr√¨nh ƒë·∫≥ng √°p: $A' = P \\cdot \\Delta V$. Ta c√≥ $\\Delta V = V_2 - V_1 = 5,0\\text{ L} - 2,0\\text{ L} = 3,0\\text{ L} = 3,0 \\times 10^{-3}\\text{ m}^3$. $A' = 1,5 \\times 10^5\\text{ Pa} \\times 3,0 \\times 10^{-3}\\text{ m}^3 = 450\\text{ J}$.", },
            { id: 13, level: "V·∫≠n d·ª•ng th·∫•p", question: "Trong qu√° tr√¨nh ƒë·∫≥ng t√≠ch, m·ªôt kh·ªëi kh√≠ nh·∫≠n nhi·ªát l∆∞·ª£ng $Q = 75\\text{ J}$. ƒê·ªô bi·∫øn thi√™n n·ªôi nƒÉng $\\Delta U$ c·ªßa kh·ªëi kh√≠ l√† bao nhi√™u?", options: ["$0\\text{ J}$", "$75\\text{ J}$", "$-75\\text{ J}$", "$150\\text{ J}$"], correctIndex: 1, explanation: "Qu√° tr√¨nh ƒë·∫≥ng t√≠ch ($\\Delta V = 0$) $\\implies$ C√¥ng $A=0$. Kh√≠ nh·∫≠n nhi·ªát: $Q = 75\\text{ J}$. √Åp d·ª•ng Nguy√™n l√≠ I: $\\Delta U = Q + A = 75 + 0 = 75\\text{ J}$.", },
            { id: 14, level: "V·∫≠n d·ª•ng th·∫•p", question: "M·ªôt h·ªá c√≥ ƒë·ªô bi·∫øn thi√™n n·ªôi nƒÉng $\\Delta U = -50\\text{ J}$, ƒë·ªìng th·ªùi h·ªá th·ª±c hi·ªán c√¥ng $A' = 20\\text{ J}$. Nhi·ªát l∆∞·ª£ng $Q$ m√† h·ªá trao ƒë·ªïi l√† bao nhi√™u?", options: ["$70\\text{ J}$", "$-70\\text{ J}$", "$-30\\text{ J}$", "$30\\text{ J}$"], correctIndex: 2, explanation: "ƒê·ªô bi·∫øn thi√™n n·ªôi nƒÉng: $\\Delta U = -50\\text{ J}$. H·ªá th·ª±c hi·ªán c√¥ng: $A' = 20\\text{ J} \\implies$ C√¥ng m√¥i tr∆∞·ªùng th·ª±c hi·ªán: $A = -20\\text{ J}$. √Åp d·ª•ng Nguy√™n l√≠ I: $\\Delta U = Q + A \\implies Q = \\Delta U - A = -50 - (-20) = -30\\text{ J}$. D·∫•u tr·ª´ cho th·∫•y h·ªá nh·∫£ nhi·ªát.", },
            { id: 15, level: "V·∫≠n d·ª•ng th·∫•p", question: "Trong m·ªôt qu√° tr√¨nh bi·∫øn ƒë·ªïi chu tr√¨nh (tr·ªü v·ªÅ tr·∫°ng th√°i ban ƒë·∫ßu), m·ªôt h·ªá th·ª±c hi·ªán c√¥ng $A' = 60\\text{ J}$. Nhi·ªát l∆∞·ª£ng $Q$ m√† h·ªá trao ƒë·ªïi l√† bao nhi√™u?", options: ["$0\\text{ J}$", "$60\\text{ J}$", "$-60\\text{ J}$", "Ph·∫£i bi·∫øt nhi·ªát ƒë·ªô ban ƒë·∫ßu v√† cu·ªëi c√πng."], correctIndex: 1, explanation: "Qu√° tr√¨nh chu tr√¨nh $\\implies$ tr·∫°ng th√°i cu·ªëi tr√πng tr·∫°ng th√°i ƒë·∫ßu $\\implies$ ƒê·ªô bi·∫øn thi√™n n·ªôi nƒÉng $\\Delta U = 0$. H·ªá th·ª±c hi·ªán c√¥ng: $A' = 60\\text{ J} \\implies A = -60\\text{ J}$. √Åp d·ª•ng Nguy√™n l√≠ I: $\\Delta U = Q + A \\implies 0 = Q + (-60) \\implies Q = 60\\text{ J}$.", },

            // C·∫•p ƒë·ªô 4: V·∫≠n d·ª•ng cao (5 c√¢u)
            { 
                id: 16, 
                level: "V·∫≠n d·ª•ng cao", 
                question: "M·ªôt kh·ªëi kh√≠ l√≠ t∆∞·ªüng th·ª±c hi·ªán hai qu√° tr√¨nh li√™n ti·∫øp: \\n (1) ƒê·∫≥ng √°p: Kh√≠ nh·∫≠n nhi·ªát $Q_1 = 400\\text{ J}$ v√† th·ª±c hi·ªán c√¥ng $A'_1 = 150\\text{ J}$. \\n (2) ƒê·∫≥ng t√≠ch: Kh√≠ nh·∫£ nhi·ªát $Q_2 = 100\\text{ J}$. \\n ƒê·ªô bi·∫øn thi√™n n·ªôi nƒÉng t·ªïng c·ªông $\\Delta U$ c·ªßa kh·ªëi kh√≠ l√† bao nhi√™u?", 
                // ƒê√É S·ª¨A L·ªñI TR√ôNG L·∫∂P: Thay "$150\\text{ J}$" ·ªü index 0 th√†nh "$250\\text{ J}$"
                options: ["$250\\text{ J}$", "$350\\text{ J}$", "$50\\text{ J}$", "$150\\text{ J}$"], 
                correctIndex: 3, 
                explanation: "Qu√° tr√¨nh (1): $Q_1 = 400\\text{ J}$, $A_1 = -A'_1 = -150\\text{ J}$. $\\Delta U_1 = Q_1 + A_1 = 400 - 150 = 250\\text{ J}$. Qu√° tr√¨nh (2): ƒê·∫≥ng t√≠ch $\\implies A_2 = 0$. Kh√≠ nh·∫£ nhi·ªát $\\implies Q_2 = -100\\text{ J}$. $\\Delta U_2 = Q_2 + A_2 = -100 + 0 = -100\\text{ J}$. ƒê·ªô bi·∫øn thi√™n t·ªïng c·ªông: $\\Delta U = \\Delta U_1 + \\Delta U_2 = 250 + (-100) = 150\\text{ J}$.", 
            },
            { id: 17, level: "V·∫≠n d·ª•ng cao", question: "M·ªôt kh·ªëi kh√≠ l√≠ t∆∞·ªüng gi√£n n·ªü ƒë·∫≥ng nhi·ªát. N√≥ nh·∫≠n nhi·ªát l∆∞·ª£ng $Q = 600\\text{ J}$. C√¥ng $A'$ do kh√≠ th·ª±c hi·ªán l√† bao nhi√™u?", options: ["$600\\text{ J}$", "$0\\text{ J}$", "$-600\\text{ J}$", "$300\\text{ J}$"], correctIndex: 0, explanation: "Gi√£n n·ªü ƒë·∫≥ng nhi·ªát $\\implies \\Delta U = 0$. Kh√≠ nh·∫≠n nhi·ªát $Q = 600\\text{ J}$. √Åp d·ª•ng Nguy√™n l√≠ I: $\\Delta U = Q + A \\implies 0 = 600 + A \\implies A = -600\\text{ J}$. C√¥ng kh√≠ th·ª±c hi·ªán $A'$ l√† $A' = -A = 600\\text{ J}$.", },
            { id: 18, level: "V·∫≠n d·ª•ng cao", question: "M·ªôt kh·ªëi kh√≠ gi√£n n·ªü ƒë·∫≥ng √°p. Trong qu√° tr√¨nh n√†y, kh√≠ nh·∫≠n nhi·ªát l∆∞·ª£ng $Q$ v√† th·ª±c hi·ªán c√¥ng $A'$. Bi·∫øt r·∫±ng ƒë·ªô bi·∫øn thi√™n n·ªôi nƒÉng $\\Delta U$ c·ªßa kh√≠ g·∫•p 2 l·∫ßn c√¥ng $A'$ m√† kh√≠ th·ª±c hi·ªán (t·ª©c l√† $\\Delta U = 2A'$). T√≠nh t·ªâ s·ªë $Q/A'$:", options: ["$1$", "$2$", "$3$", "$4$"], correctIndex: 2, explanation: "C√¥ng kh√≠ th·ª±c hi·ªán: $A' = -A$. √Åp d·ª•ng Nguy√™n l√≠ I: $\\Delta U = Q + A = Q - A'$. Theo ƒë·ªÅ b√†i: $\\Delta U = 2A'$. Thay v√†o: $2A' = Q - A' \\implies Q = 2A' + A' = 3A'$. V·∫≠y t·ªâ s·ªë $Q/A' = 3$.", },
            { id: 19, level: "V·∫≠n d·ª•ng cao", question: "M·ªôt kh·ªëi kh√≠ ƒë∆∞·ª£c n√©n ƒëo·∫°n nhi·ªát. C√¥ng $A$ do m√¥i tr∆∞·ªùng th·ª±c hi·ªán l√™n kh·ªëi kh√≠ l√† $A = 250\\text{ J}$. ƒê·ªô bi·∫øn thi√™n n·ªôi nƒÉng $\\Delta U$ c·ªßa kh·ªëi kh√≠ l√† bao nhi√™u v√† kh√≠ n√≥ng l√™n hay ngu·ªôi ƒëi?", options: ["$\\Delta U = 0\\text{ J}$, kh√≠ ngu·ªôi ƒëi.", "$\\Delta U = -250\\text{ J}$, kh√≠ ngu·ªôi ƒëi.", "$\\Delta U = 250\\text{ J}$, kh√≠ n√≥ng l√™n.", "$\\Delta U = 250\\text{ J}$, kh√≠ ngu·ªôi ƒëi."], correctIndex: 2, explanation: "Qu√° tr√¨nh n√©n ƒëo·∫°n nhi·ªát $\\implies Q=0$. C√¥ng m√¥i tr∆∞·ªùng th·ª±c hi·ªán: $A = 250\\text{ J}$ ($A>0$). √Åp d·ª•ng Nguy√™n l√≠ I: $\\Delta U = Q + A = 0 + 250 = 250\\text{ J}$. V√¨ $\\Delta U > 0$, n·ªôi nƒÉng tƒÉng, nhi·ªát ƒë·ªô c·ªßa kh√≠ tƒÉng l√™n (kh√≠ n√≥ng l√™n).", },
            { id: 20, level: "V·∫≠n d·ª•ng cao", question: "M·ªôt kh·ªëi kh√≠ bi·∫øn ƒë·ªïi t·ª´ tr·∫°ng th√°i 1 sang tr·∫°ng th√°i 3 th√¥ng qua tr·∫°ng th√°i 2 ($1 \\to 2$ l√† ƒë·∫≥ng √°p, $2 \\to 3$ l√† ƒë·∫≥ng nhi·ªát). Trong qu√° tr√¨nh $1 \\to 2$, kh√≠ th·ª±c hi·ªán c√¥ng $A'_{12} = 5\\text{ J}$ v√† n·ªôi nƒÉng tƒÉng $\\Delta U_{12} = 30\\text{ J}$. Qu√° tr√¨nh $2 \\to 3$ kh√≠ nh·∫≠n nhi·ªát $Q_{23} = 15\\text{ J}$. T√≠nh ƒë·ªô bi·∫øn thi√™n n·ªôi nƒÉng $\\Delta U_{13}$ c·ªßa c·∫£ qu√° tr√¨nh.", options: ["$30\\text{ J}$", "$45\\text{ J}$", "$35\\text{ J}$", "$50\\text{ J}$"], correctIndex: 0, explanation: "ƒê·ªô bi·∫øn thi√™n n·ªôi nƒÉng to√†n qu√° tr√¨nh: $\\Delta U_{13} = \\Delta U_{12} + \\Delta U_{23}$. Qu√° tr√¨nh $2 \\to 3$ l√† ƒë·∫≥ng nhi·ªát $\\implies$ nhi·ªát ƒë·ªô kh√¥ng ƒë·ªïi $\\implies \\Delta U_{23} = 0$. Do ƒë√≥, $\\Delta U_{13} = 30\\text{ J} + 0\\text{ J} = 30\\text{ J}$. (L∆∞u √Ω: $A'_{12}$ v√† $Q_{23}$ l√† th√¥ng tin th·ª´a ƒë·ªÉ t√≠nh $\\Delta U_{13}$).", },
        ];
        
        // --- 2. GLOBAL STATE ---
        let currentQuestionIndex = 0;
        let userAnswers = Array(rawQuestions.length).fill(null);
        let quizSubmitted = false;
        
        // --- 3. DOM ELEMENTS ---
        const contentArea = document.getElementById('content-area');
        const questionNav = document.getElementById('question-nav');
        const toastContainer = document.getElementById('toast-container');
        const submitButton = document.getElementById('submit-quiz-button');

        // --- 4. UTILITIES ---
        const optionLabels = ['A', 'B', 'C', 'D'];
        
        /** Hi·ªÉn th·ªã th√¥ng b√°o ƒë·ªông vi√™n/c·ªï v≈© */
        function showToast(message, type = 'success') {
            const icon = type === 'success' ? 'üéâ' : 'ü§î';
            const bgColor = type === 'success' ? 'bg-green-100 border-green-400 text-green-700' : 'bg-red-100 border-red-400 text-red-700';
            
            const toast = document.createElement('div');
            toast.className = `p-4 rounded-lg border-2 shadow-xl ${bgColor} flex items-center transform transition-all duration-500 ease-out translate-x-full opacity-0 font-normal`; // Th√™m font-normal
            toast.innerHTML = `<span class="text-xl mr-3">${icon}</span> <span>${message}</span>`;
            
            toastContainer.appendChild(toast);
            
            // Animate in
            setTimeout(() => {
                toast.classList.remove('translate-x-full', 'opacity-0');
                toast.classList.add('translate-x-0', 'opacity-100');
            }, 10);
            
            // Animate out and remove
            setTimeout(() => {
                toast.classList.add('opacity-0');
                setTimeout(() => toast.remove(), 500);
            }, 3000);
        }

        // --- 5. NAVIGATION AND RENDERING ---
        
        /** C·∫≠p nh·∫≠t thanh ƒëi·ªÅu h∆∞·ªõng c√¢u h·ªèi */
        function renderQuestionNav() {
            questionNav.innerHTML = '';
            rawQuestions.forEach((q, index) => {
                const navButton = document.createElement('button');
                // Gi·ªØ font-semibold cho n√∫t s·ªë
                navButton.className = 'question-nav-button w-8 h-8 md:w-10 md:h-10 rounded-full border-2 border-gray-300 flex items-center justify-center font-semibold text-sm transition-all duration-200 focus:outline-none';
                navButton.textContent = q.id;
                navButton.onclick = () => jumpToQuestion(index);
                
                // C·∫≠p nh·∫≠t tr·∫°ng th√°i tr·∫£ l·ªùi
                if (userAnswers[index] !== null) {
                    navButton.classList.add('answered');
                    if (quizSubmitted) {
                        const isCorrect = userAnswers[index] === rawQuestions[index].correctIndex;
                        navButton.classList.remove('answered');
                        navButton.classList.add(isCorrect ? 'correct' : 'incorrect');
                    }
                }
                
                // ƒê√°nh d·∫•u c√¢u h·ªèi hi·ªán t·∫°i
                if (index === currentQuestionIndex && !quizSubmitted) {
                    navButton.classList.add('bg-blue-200', 'border-blue-500', 'text-blue-700');
                }

                questionNav.appendChild(navButton);
            });
        }

        /** Render n·ªôi dung c√¢u h·ªèi hi·ªán t·∫°i */
        function renderQuestion() {
            if (quizSubmitted) return;

            const q = rawQuestions[currentQuestionIndex];
            const currentAnswer = userAnswers[currentQuestionIndex];
            
            contentArea.innerHTML = `
                <div class="mb-6">
                    <div class="text-sm font-medium text-gray-500 font-normal mb-1">C·∫•p ƒë·ªô: ${q.level}</div>
                    <!-- Ti√™u ƒë·ªÅ c√¢u h·ªèi (H2) gi·ªØ font-semibold/bold -->
                    <h2 class="text-xl font-semibold text-gray-800 mb-4 border-l-4 border-blue-500 pl-3">
                        C√¢u ${q.id}: ${q.question}
                    </h2>
                </div>
                <div id="options-list" class="space-y-4">
                    ${q.options.map((optionText, index) => `
                        <div class="option-item ${currentAnswer === index ? 'selected-option' : 'border-gray-200 hover:border-blue-400'}" 
                             data-index="${index}"
                             onclick="handleOptionClick(${index})"
                             role="button"
                             tabindex="0"
                             class="p-4 rounded-lg border cursor-pointer transition duration-200 ease-in-out">
                            <div class="flex items-start">
                                <span class="answer-label bg-gray-200 text-gray-700 font-semibold rounded-full p-2 mr-4 transition duration-200">
                                    ${optionLabels[index]}
                                </span>
                                <!-- N·ªôi dung ƒë√°p √°n l√† font-normal/m·∫£nh -->
                                <span class="flex-1 pt-1 font-normal">${optionText}</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <div class="mt-8 flex justify-between">
                    <button onclick="prevQuestion()" ${currentQuestionIndex === 0 ? 'disabled' : ''} class="px-6 py-2 bg-gray-300 text-gray-700 font-semibold rounded-lg hover:bg-gray-400 disabled:opacity-50 transition duration-200">
                        &larr; C√¢u tr∆∞·ªõc
                    </button>
                    <button onclick="nextQuestion()" class="px-6 py-2 bg-blue-500 text-white font-semibold rounded-lg hover:bg-blue-600 transition duration-200">
                        ${currentQuestionIndex === rawQuestions.length - 1 ? 'Quay l·∫°i' : 'C√¢u ti·∫øp theo &rarr;'}
                    </button>
                </div>
            `;
            renderQuestionNav();
            // G·ªçi MathJax ƒë·ªÉ render c√¥ng th·ª©c sau khi n·ªôi dung ƒë√£ ƒë∆∞·ª£c th√™m v√†o DOM
            if (typeof MathJax !== 'undefined') {
                MathJax.typesetPromise([contentArea]);
            }
        }

        // --- 6. HANDLERS ---
        
        /** X·ª≠ l√Ω s·ª± ki·ªán ch·ªçn ƒë√°p √°n */
        function handleOptionClick(selectedIndex) {
            if (quizSubmitted) return;
            
            const q = rawQuestions[currentQuestionIndex];

            // X√≥a style c≈© v√† th√™m style m·ªõi
            const options = document.querySelectorAll('.option-item');
            options.forEach(opt => opt.classList.remove('selected-option', 'border-gray-200', 'hover:border-blue-400'));
            
            // C·∫≠p nh·∫≠t c√¢u tr·∫£ l·ªùi c·ªßa ng∆∞·ªùi d√πng
            userAnswers[currentQuestionIndex] = selectedIndex;
            
            // ƒê√°nh d·∫•u ƒë√°p √°n ƒë√£ ch·ªçn
            const selectedElement = document.querySelector(`.option-item[data-index="${selectedIndex}"]`);
            selectedElement.classList.add('selected-option');
            
            // Hi·ªÉn th·ªã th√¥ng b√°o ƒë·ªông vi√™n/c·ªï v≈©
            showToast("Tuy·ªát v·ªùi, ƒë√£ l∆∞u ƒë√°p √°n! Ti·∫øp t·ª•c th√¥i! üéâ", 'success');
            
            // C·∫≠p nh·∫≠t thanh ƒëi·ªÅu h∆∞·ªõng
            renderQuestionNav();
            
            // T·ª± ƒë·ªông chuy·ªÉn sang c√¢u ti·∫øp theo (n·∫øu ch∆∞a ph·∫£i c√¢u cu·ªëi)
            setTimeout(() => {
                if (currentQuestionIndex < rawQuestions.length - 1) {
                    nextQuestion();
                } else {
                    // N·∫øu l√† c√¢u cu·ªëi, ch·ªâ c·∫ßn c·∫≠p nh·∫≠t tr·∫°ng th√°i
                    renderQuestion();
                }
            }, 500);
        }

        /** Chuy·ªÉn sang c√¢u h·ªèi ti·∫øp theo */
        function nextQuestion() {
            if (currentQuestionIndex < rawQuestions.length - 1) {
                currentQuestionIndex++;
                renderQuestion();
            }
        }

        /** Chuy·ªÉn v·ªÅ c√¢u h·ªèi tr∆∞·ªõc */
        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion();
            }
        }

        /** Chuy·ªÉn ƒë·∫øn c√¢u h·ªèi theo ch·ªâ m·ª•c */
        function jumpToQuestion(index) {
            currentQuestionIndex = index;
            if (quizSubmitted) {
                renderReviewQuestion();
            } else {
                renderQuestion();
            }
        }
        
        // --- 7. RESULT SCREEN ---
        
        /** T√≠nh to√°n v√† hi·ªÉn th·ªã k·∫øt qu·∫£ */
        function showResults() {
            quizSubmitted = true;
            submitButton.disabled = true;
            
            let score = 0;
            const categoryScores = { "Ghi nh·ªõ": { total: 0, correct: 0 }, "Hi·ªÉu": { total: 0, correct: 0 }, "V·∫≠n d·ª•ng th·∫•p": { total: 0, correct: 0 }, "V·∫≠n d·ª•ng cao": { total: 0, correct: 0 } };
            const motivationalMessages = [
                { minScore: 0, message: "B·∫°n c√≥ th·ªÉ l√†m t·ªët h∆°n! C√πng √¥n t·∫≠p l·∫°i c√°c kh√°i ni·ªám c∆° b·∫£n nh√©!", color: "text-red-600" },
                { minScore: 10, message: "K·∫øt qu·∫£ kh√° t·ªët! C·∫ßn ch√∫ √Ω th√™m c√°c b√†i t·∫≠p v·∫≠n d·ª•ng. C·ªë l√™n! üí™", color: "text-yellow-600" },
                { minScore: 15, message: "Xu·∫•t s·∫Øc! Ki·∫øn th·ª©c v·ªØng v√†ng. R·∫•t ƒë√°ng kh√≠ch l·ªá! ‚ú®", color: "text-green-600" },
                { minScore: 20, message: "Ho√†n h·∫£o! B·∫°n l√† chuy√™n gia v·ªÅ Nhi·ªát ƒë·ªông l·ª±c h·ªçc! Ch√∫c m·ª´ng! üèÜ", color: "text-blue-600" },
            ];

            rawQuestions.forEach((q, index) => {
                categoryScores[q.level].total++;
                if (userAnswers[index] === q.correctIndex) {
                    score++;
                    categoryScores[q.level].correct++;
                }
            });

            // Ch·ªçn th√¥ng ƒëi·ªáp ƒë·ªông vi√™n
            let message = motivationalMessages[0];
            for (const m of motivationalMessages) {
                if (score >= m.minScore) {
                    message = m;
                }
            }
            
            // T·∫°o b·∫£ng t√≥m t·∫Øt chi ti·∫øt
            const summaryTable = Object.keys(categoryScores).map(level => {
                const data = categoryScores[level];
                const percentage = data.total > 0 ? ((data.correct / data.total) * 100).toFixed(0) : 0;
                let colorClass = 'text-gray-700';
                if (percentage >= 80) colorClass = 'text-green-600 font-bold';
                else if (percentage >= 50) colorClass = 'text-yellow-600 font-bold';
                else colorClass = 'text-red-600 font-bold';
                
                return `
                    <tr class="border-b hover:bg-gray-50 font-normal">
                        <td class="py-3 px-4 text-left">${level}</td>
                        <td class="py-3 px-4 text-center">${data.correct} / ${data.total}</td>
                        <td class="py-3 px-4 text-right ${colorClass}">${percentage}%</td>
                    </tr>
                `;
            }).join('');

            // Render k·∫øt qu·∫£
            contentArea.innerHTML = `
                <div class="text-center p-6 md:p-10">
                    <div class="text-7xl mb-4">${message.minScore === 20 ? 'ü•á' : (score >= 15 ? 'üåü' : (score >= 10 ? 'üí°' : 'üå±'))}</div>
                    <h2 class="text-4xl font-extrabold text-gray-800 mb-4">K·∫øt Qu·∫£ B√†i L√†m C·ªßa B·∫°n</h2>
                    <p class="text-6xl font-black ${message.color}">${score} / ${rawQuestions.length}</p>
                    <p class="text-2xl mt-4 ${message.color} font-semibold">${message.message}</p>
                    
                    <div class="mt-10 max-w-lg mx-auto bg-gray-100 p-6 rounded-xl shadow-inner font-normal">
                        <h3 class="text-xl font-bold mb-4 border-b pb-2 text-gray-700">T√≥m T·∫Øt Chi Ti·∫øt Theo Tr√¨nh ƒê·ªô</h3>
                        <table class="w-full text-left text-sm bg-white rounded-lg overflow-hidden">
                            <thead class="bg-blue-500 text-white font-semibold">
                                <tr>
                                    <th class="py-3 px-4">Tr√¨nh ƒë·ªô</th>
                                    <th class="py-3 px-4 text-center">ƒê√∫ng/T·ªïng</th>
                                    <th class="py-3 px-4 text-right">T·ª∑ l·ªá</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${summaryTable}
                            </tbody>
                        </table>
                    </div>
                    
                    <button onclick="reviewAnswers()" class="mt-8 px-8 py-3 bg-indigo-500 text-white font-bold rounded-lg hover:bg-indigo-600 transition duration-300 shadow-lg focus:outline-none focus:ring-4 focus:ring-indigo-300">
                        Xem l·∫°i ƒë√°p √°n
                    </button>
                </div>
            `;
            renderQuestionNav(); // C·∫≠p nh·∫≠t m√†u s·∫Øc thanh ƒëi·ªÅu h∆∞·ªõng theo k·∫øt qu·∫£
        }

        /** Cho ph√©p ng∆∞·ªùi d√πng xem l·∫°i ƒë√°p √°n sau khi n·ªôp b√†i */
        function reviewAnswers() {
            // T·∫Øt n√∫t n·ªôp b√†i v√† chuy·ªÉn v·ªÅ c√¢u h·ªèi 1
            submitButton.style.display = 'none';
            currentQuestionIndex = 0;
            renderReviewQuestion();
        }

        /** Render c√¢u h·ªèi trong ch·∫ø ƒë·ªô xem l·∫°i */
        function renderReviewQuestion() {
            const q = rawQuestions[currentQuestionIndex];
            const userAnswerIndex = userAnswers[currentQuestionIndex];
            const isCorrect = userAnswerIndex === q.correctIndex;
            
            // H√†m chuy·ªÉn ƒë·ªïi Markdown/LaTeX ƒë∆°n gi·∫£n th√†nh HTML
            function formatExplanation(text) {
                // Thay th·∫ø \\n th√†nh <br>
                text = text.replace(/\\n/g, '<br>');
                // KH√îNG thay th·∫ø $...$ v√¨ MathJax s·∫Ω x·ª≠ l√Ω
                return text;
            }

            contentArea.innerHTML = `
                <div class="mb-6">
                    <div class="text-sm font-medium text-gray-500 font-normal mb-1">C·∫•p ƒë·ªô: ${q.level}</div>
                    <!-- Ti√™u ƒë·ªÅ c√¢u h·ªèi (H2) gi·ªØ font-semibold/bold -->
                    <h2 class="text-xl font-semibold text-gray-800 mb-4 border-l-4 ${isCorrect ? 'border-green-500' : 'border-red-500'} pl-3">
                        C√¢u ${q.id}: ${q.question}
                    </h2>
                    <p class="mt-2 text-lg font-semibold ${isCorrect ? 'text-green-600' : 'text-red-600'}">
                        Tr·∫°ng th√°i: ${isCorrect ? 'CH√çNH X√ÅC' : 'SAI'}
                    </p>
                </div>
                
                <!-- Hi·ªÉn th·ªã c√°c l·ª±a ch·ªçn -->
                <div id="options-list" class="space-y-4">
                    ${q.options.map((optionText, index) => {
                        let optionClass = 'border-gray-200';
                        if (index === q.correctIndex) {
                            optionClass = 'correct-answer'; // ƒê√°p √°n ƒë√∫ng
                        } else if (index === userAnswerIndex) {
                            optionClass = 'incorrect-answer'; // ƒê√°p √°n ng∆∞·ªùi d√πng ch·ªçn (v√† b·ªã sai)
                        }
                        
                        return `
                            <div class="p-4 rounded-lg border-2 ${optionClass}">
                                <div class="flex items-start">
                                    <span class="answer-label bg-gray-200 text-gray-700 font-semibold rounded-full p-2 mr-4 transition duration-200">
                                        ${optionLabels[index]}
                                    </span>
                                    <!-- N·ªôi dung ƒë√°p √°n l√† font-normal/m·∫£nh -->
                                    <span class="flex-1 pt-1 font-normal">${optionText}</span>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
                
                <!-- Gi·∫£i th√≠ch chi ti·∫øt -->
                <div class="mt-8 p-5 bg-blue-50 border-l-4 border-blue-500 rounded-lg shadow-md font-normal">
                    <h3 class="text-xl font-bold text-blue-700 mb-3 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Gi·∫£i th√≠ch chi ti·∫øt
                    </h3>
                    <p class="text-gray-700 leading-relaxed">
                        ${formatExplanation(q.explanation || 'Kh√¥ng c√≥ gi·∫£i th√≠ch chi ti·∫øt cho c√¢u h·ªèi n√†y.')}
                    </p>
                    <p class="mt-3 text-sm font-semibold text-green-700">
                        ƒê√°p √°n ƒë√∫ng l√†: ${optionLabels[q.correctIndex]}
                    </p>
                </div>
                
                <div class="mt-8 flex justify-between">
                    <button onclick="reviewPrev()" ${currentQuestionIndex === 0 ? 'disabled' : ''} class="px-6 py-2 bg-gray-300 text-gray-700 font-semibold rounded-lg hover:bg-gray-400 disabled:opacity-50 transition duration-200">
                        &larr; C√¢u tr∆∞·ªõc
                    </button>
                    <button onclick="reviewNext()" ${currentQuestionIndex === rawQuestions.length - 1 ? 'disabled' : ''} class="px-6 py-2 bg-blue-500 text-white font-semibold rounded-lg hover:bg-blue-600 disabled:opacity-50 transition duration-200">
                        C√¢u ti·∫øp theo &rarr;
                    </button>
                </div>
            `;
            renderQuestionNav();
            // G·ªçi MathJax ƒë·ªÉ render c√¥ng th·ª©c sau khi n·ªôi dung ƒë√£ ƒë∆∞·ª£c th√™m v√†o DOM
            if (typeof MathJax !== 'undefined') {
                MathJax.typesetPromise([contentArea]);
            }
        }

        function reviewNext() {
            if (currentQuestionIndex < rawQuestions.length - 1) {
                currentQuestionIndex++;
                renderReviewQuestion();
            }
        }

        function reviewPrev() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderReviewQuestion();
            }
        }


        // --- 8. INITIALIZATION ---
        
        /** Kh·ªüi t·∫°o ·ª©ng d·ª•ng */
        function init() {
            renderQuestion();
            submitButton.style.display = 'block';
        }

        // B·∫Øt ƒë·∫ßu ·ª©ng d·ª•ng khi t√†i li·ªáu ƒë∆∞·ª£c t·∫£i
        window.onload = init;

    </script>
</body>
</html>
