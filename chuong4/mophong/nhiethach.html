<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mô phỏng Phản ứng Nhiệt hạch Lõi Mặt Trời</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #050505;
            color: #fff;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        canvas {
            display: block;
        }
        .controls {
            position: absolute;
            top: 80px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #f59e0b;
            width: 300px;
            z-index: 10;
        }
        .tab-btn {
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 2px solid transparent;
        }
        .tab-btn.active {
            border-bottom: 2px solid #f59e0b;
            color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
        }
        #knowledge-tab {
            position: absolute;
            top: 70px;
            left: 0;
            width: 100%;
            height: calc(100% - 70px);
            background: rgba(5, 5, 5, 0.95);
            z-index: 20;
            overflow-y: auto;
            padding: 40px;
            display: none;
        }
        .energy-flash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: white;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.1s;
        }
        .formula-card {
            background: rgba(255, 255, 255, 0.05);
            border-left: 4px solid #f59e0b;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>

    <!-- Header / Tab Switcher -->
    <div class="fixed top-0 left-0 w-full h-[70px] bg-black border-b border-gray-800 flex items-center px-8 z-30">
        <h1 class="text-xl font-bold text-orange-500 mr-12 uppercase tracking-wider">Fusion Simulator</h1>
        <div class="flex space-x-4">
            <div id="btn-sim" class="tab-btn active font-semibold" onclick="switchTab('sim')">MÔ PHỎNG</div>
            <div id="btn-knowledge" class="tab-btn font-semibold" onclick="switchTab('knowledge')">KIẾN THỨC</div>
        </div>
    </div>

    <div id="flash" class="energy-flash"></div>

    <!-- Tab 1: Simulation -->
    <div id="simulation-content">
        <div class="controls">
            <h2 class="text-lg font-bold text-orange-400 mb-2">Điều khiển Plasma</h2>
            <p class="text-xs text-gray-400 mb-4 italic">Nhiệt độ lõi: ~15,000,000 K</p>
            
            <div class="mb-6">
                <label class="block text-sm mb-2 font-medium">Mật độ hạt (Proton)</label>
                <input type="range" id="particleCount" min="30" max="200" value="100" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-orange-500">
            </div>
            
            <div class="mb-6 p-3 bg-black/40 rounded-lg border border-gray-700">
                <p class="text-xs uppercase text-gray-500 font-bold mb-1">Trạng thái:</p>
                <p id="currentPhase" class="text-sm text-orange-200 leading-tight">Sẵn sàng kích hoạt...</p>
            </div>

            <button id="triggerFusion" class="w-full bg-orange-600 hover:bg-orange-500 text-white font-bold py-3 px-4 rounded-lg shadow-lg shadow-orange-900/20 transition-all active:scale-95">
                BẮT ĐẦU CHU TRÌNH P-P
            </button>
        </div>

        <div class="fixed bottom-8 left-8 bg-black/70 p-4 rounded-xl border border-gray-800 text-sm">
            <div class="flex items-center mb-2"><div class="w-3 h-3 rounded-full bg-[#ef4444] mr-3"></div> Proton (¹H)</div>
            <div class="flex items-center mb-2"><div class="w-3 h-3 rounded-full bg-[#3b82f6] mr-3"></div> Neutron (n)</div>
            <div class="flex items-center mb-2"><div class="w-3 h-3 rounded-full bg-[#f59e0b] border border-white mr-3"></div> Helium Hạt nhân</div>
            <div class="flex items-center"><div class="w-3 h-3 rounded-full bg-white shadow-[0_0_5px_white] mr-3"></div> Neutrino/Gamma</div>
        </div>

        <div class="fixed bottom-8 right-8 bg-black/70 p-5 rounded-xl border border-orange-900/50 text-right">
            <div class="text-3xl font-mono text-orange-400" id="energyCounter">0.00 MeV</div>
            <div class="text-[10px] uppercase tracking-widest text-gray-500">Năng lượng tích lũy</div>
        </div>

        <canvas id="canvas"></canvas>
    </div>

    <!-- Tab 2: Knowledge -->
    <div id="knowledge-tab">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-4xl font-bold text-orange-500 mb-6">Chu trình Proton-Proton (p-p chain)</h1>
            
            <p class="text-lg text-gray-300 mb-8 leading-relaxed">
                Phản ứng nhiệt hạch trong lõi Mặt Trời là quá trình biến đổi vật chất từ Hydro thành Helium. Đây là nguồn gốc của hầu hết năng lượng mà Mặt Trời phát ra, duy trì sự sống trên Trái Đất.
            </p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
                <div class="bg-gray-900/50 p-6 rounded-2xl border border-gray-800">
                    <h3 class="text-xl font-bold text-orange-400 mb-4">Thông số Vật lý</h3>
                    <ul class="space-y-3 text-gray-300">
                        <li><span class="text-orange-500 font-bold">●</span> <strong>Nhiệt độ:</strong> Khoảng 15 triệu độ Kelvin.</li>
                        <li><span class="text-orange-500 font-bold">●</span> <strong>Áp suất:</strong> 250 tỷ lần áp suất khí quyển Trái Đất.</li>
                        <li><span class="text-orange-500 font-bold">●</span> <strong>Thời gian:</strong> Một proton trung bình mất 9 tỷ năm để thực hiện phản ứng đầu tiên.</li>
                    </ul>
                </div>
                <div class="bg-gray-900/50 p-6 rounded-2xl border border-gray-800">
                    <h3 class="text-xl font-bold text-orange-400 mb-4">Sản phẩm đầu ra</h3>
                    <ul class="space-y-3 text-gray-300">
                        <li><span class="text-orange-500 font-bold">●</span> <strong>Helium-4:</strong> Hạt nhân ổn định cuối cùng.</li>
                        <li><span class="text-orange-500 font-bold">●</span> <strong>Neutrino:</strong> Hạt không khối lượng, bay xuyên qua mọi vật chất.</li>
                        <li><span class="text-orange-500 font-bold">●</span> <strong>Tia Gamma:</strong> Năng lượng ánh sáng thuần khiết.</li>
                    </ul>
                </div>
            </div>

            <h2 class="text-2xl font-bold mb-6 text-white border-b border-gray-800 pb-2">3 Bước của Chu trình</h2>
            
            <div class="space-y-6">
                <div class="formula-card">
                    <h4 class="text-orange-400 font-bold mb-2">BƯỚC 1: Tạo Deuterium</h4>
                    <p class="text-gray-300 mb-2">Hai proton (¹H) hợp nhất. Một proton biến thành neutron, giải phóng một positron và một neutrino.</p>
                    <code class="text-sm bg-black p-2 rounded block">¹H + ¹H → ²H + e⁺ + νₑ (+0.42 MeV)</code>
                </div>

                <div class="formula-card">
                    <h4 class="text-orange-400 font-bold mb-2">BƯỚC 2: Tạo Helium-3</h4>
                    <p class="text-gray-300 mb-2">Deuterium kết hợp với một proton khác tạo ra đồng vị nhẹ của Helium và tia Gamma năng lượng cao.</p>
                    <code class="text-sm bg-black p-2 rounded block">²H + ¹H → ³He + γ (+5.49 MeV)</code>
                </div>

                <div class="formula-card">
                    <h4 class="text-orange-400 font-bold mb-2">BƯỚC 3: Tạo Helium-4</h4>
                    <p class="text-gray-300 mb-2">Hai hạt Helium-3 va chạm, tạo ra Helium-4 ổn định và giải phóng ngược lại 2 proton để bắt đầu chu kỳ mới.</p>
                    <code class="text-sm bg-black p-2 rounded block">³He + ³He → ⁴He + 2¹H (+12.86 MeV)</code>
                </div>
            </div>

            <div class="mt-12 mb-20 text-center p-8 bg-orange-950/20 border border-orange-900/30 rounded-3xl">
                <p class="italic text-orange-200">
                    "Mỗi giây, Mặt Trời biến đổi khoảng 600 triệu tấn Hydro thành Helium, giải phóng một lượng năng lượng tương đương hàng tỷ quả bom nguyên tử."
                </p>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const flash = document.getElementById('flash');
        const energyDisplay = document.getElementById('energyCounter');
        const phaseDisplay = document.getElementById('currentPhase');
        
        let width, height;
        let particles = [];
        let effects = [];
        let totalEnergy = 0;
        let fusionCooldown = false;

        const TYPES = {
            PROTON: 'proton', NEUTRON: 'neutron', DEUTERIUM: 'deuterium',
            HELIUM3: 'helium3', HELIUM4: 'helium4', NEUTRINO: 'neutrino', GAMMA: 'gamma'
        };

        function switchTab(tab) {
            const simTab = document.getElementById('simulation-content');
            const knowTab = document.getElementById('knowledge-tab');
            const btnSim = document.getElementById('btn-sim');
            const btnKnow = document.getElementById('btn-knowledge');

            if (tab === 'sim') {
                simTab.style.display = 'block';
                knowTab.style.display = 'none';
                btnSim.classList.add('active');
                btnKnow.classList.remove('active');
            } else {
                simTab.style.display = 'none';
                knowTab.style.display = 'block';
                btnSim.classList.remove('active');
                btnKnow.classList.add('active');
            }
        }

        class Particle {
            constructor(x, y, type) {
                this.x = x || Math.random() * width;
                this.y = y || Math.random() * height;
                this.type = type || TYPES.PROTON;
                this.radius = this.getRadius();
                this.vx = (Math.random() - 0.5) * 4;
                this.vy = (Math.random() - 0.5) * 4;
                this.life = 1.0;
                this.color = this.getColor();
            }

            getRadius() {
                switch(this.type) {
                    case TYPES.PROTON: return 6;
                    case TYPES.NEUTRON: return 6;
                    case TYPES.DEUTERIUM: return 9;
                    case TYPES.HELIUM3: return 11;
                    case TYPES.HELIUM4: return 13;
                    default: return 3;
                }
            }

            getColor() {
                switch(this.type) {
                    case TYPES.PROTON: return '#ef4444';
                    case TYPES.NEUTRON: return '#3b82f6';
                    case TYPES.DEUTERIUM: return '#8b5cf6';
                    case TYPES.HELIUM3: return '#f59e0b';
                    case TYPES.HELIUM4: return '#fbbf24';
                    case TYPES.NEUTRINO: return '#ffffff';
                    case TYPES.GAMMA: return '#fdf2f2';
                    default: return '#fff';
                }
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                if (this.x < 0 || this.x > width) this.vx *= -1;
                if (this.y < 0 || this.y > height) this.vy *= -1;
                if (this.type === TYPES.NEUTRINO || this.type === TYPES.GAMMA) this.life -= 0.015;
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                if (this.type === TYPES.GAMMA) { ctx.shadowBlur = 20; ctx.shadowColor = "white"; }
                ctx.fill();
                ctx.shadowBlur = 0;

                if (this.type === TYPES.DEUTERIUM) {
                    this.drawNode(this.x - 3, this.y, '#ef4444', 5);
                    this.drawNode(this.x + 3, this.y, '#3b82f6', 5);
                } else if (this.type === TYPES.HELIUM3) {
                    this.drawNode(this.x - 4, this.y + 2, '#ef4444', 5);
                    this.drawNode(this.x + 4, this.y + 2, '#ef4444', 5);
                    this.drawNode(this.x, this.y - 4, '#3b82f6', 5);
                } else if (this.type === TYPES.HELIUM4) {
                    this.drawNode(this.x - 5, this.y - 5, '#ef4444', 6);
                    this.drawNode(this.x + 5, this.y + 5, '#ef4444', 6);
                    this.drawNode(this.x - 5, this.y + 5, '#3b82f6', 6);
                    this.drawNode(this.x + 5, this.y - 5, '#3b82f6', 6);
                }
            }

            drawNode(x, y, color, r) {
                ctx.beginPath(); ctx.arc(x, y, r, 0, Math.PI * 2);
                ctx.fillStyle = color; ctx.fill();
            }
        }

        class Effect {
            constructor(x, y) { this.x = x; this.y = y; this.radius = 2; this.opacity = 1.0; }
            update() { this.radius += 5; this.opacity -= 0.04; }
            draw() {
                ctx.beginPath(); ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.strokeStyle = `rgba(255, 200, 50, ${this.opacity})`;
                ctx.lineWidth = 3; ctx.stroke();
            }
        }

        function init() {
            resize();
            createInitialPlasma();
            animate();
        }

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }

        function createInitialPlasma() {
            const count = document.getElementById('particleCount').value;
            particles = [];
            for (let i = 0; i < count; i++) particles.push(new Particle());
        }

        function addEnergy(amount) {
            totalEnergy += amount;
            energyDisplay.innerText = totalEnergy.toFixed(2) + " MeV";
            flash.style.opacity = "0.4";
            setTimeout(() => flash.style.opacity = "0", 80);
        }

        async function runProtonChain() {
            if (fusionCooldown) return;
            fusionCooldown = true;

            // Step 1
            phaseDisplay.innerText = "Bước 1: p + p -> Deuterium (+0.42 MeV)";
            let p1 = particles.find(p => p.type === TYPES.PROTON);
            let p2 = particles.find(p => p.type === TYPES.PROTON && p !== p1);
            if (p1 && p2) {
                effects.push(new Effect(p1.x, p1.y));
                p1.type = TYPES.DEUTERIUM; p1.radius = p1.getRadius();
                particles = particles.filter(p => p !== p2);
                addEnergy(0.42);
                particles.push(new Particle(p1.x, p1.y, TYPES.NEUTRINO));
            }
            await sleep(1500);

            // Step 2
            phaseDisplay.innerText = "Bước 2: ²H + p -> Helium-3 (+5.49 MeV)";
            let deut = particles.find(p => p.type === TYPES.DEUTERIUM);
            let p3 = particles.find(p => p.type === TYPES.PROTON);
            if (deut && p3) {
                effects.push(new Effect(deut.x, deut.y));
                deut.type = TYPES.HELIUM3; deut.radius = deut.getRadius();
                particles = particles.filter(p => p !== p3);
                addEnergy(5.49);
                particles.push(new Particle(deut.x, deut.y, TYPES.GAMMA));
            }
            await sleep(2000);

            // Step 3
            phaseDisplay.innerText = "Bước 3: ³He + ³He -> Helium-4 (+12.86 MeV)";
            let he3_1 = particles.find(p => p.type === TYPES.HELIUM3);
            let he3_2 = new Particle(Math.random()*width, Math.random()*height, TYPES.HELIUM3);
            particles.push(he3_2);
            await sleep(1000);
            effects.push(new Effect(he3_1.x, he3_1.y));
            he3_1.type = TYPES.HELIUM4; he3_1.radius = he3_1.getRadius();
            particles = particles.filter(p => p !== he3_2);
            particles.push(new Particle(he3_1.x, he3_1.y, TYPES.PROTON));
            particles.push(new Particle(he3_1.x, he3_1.y, TYPES.PROTON));
            addEnergy(12.86);

            setTimeout(() => {
                phaseDisplay.innerText = "Chu trình hoàn tất. Sẵn sàng tiếp theo...";
                fusionCooldown = false;
            }, 2000);
        }

        function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

        function animate() {
            ctx.fillStyle = 'rgba(5, 5, 5, 0.3)';
            ctx.fillRect(0, 0, width, height);

            particles.forEach((p, i) => {
                p.update(); p.draw();
                if (p.life <= 0) particles.splice(i, 1);
            });

            effects.forEach((e, i) => {
                e.update(); e.draw();
                if (e.opacity <= 0) effects.splice(i, 1);
            });
            requestAnimationFrame(animate);
        }

        window.addEventListener('resize', resize);
        document.getElementById('particleCount').addEventListener('input', createInitialPlasma);
        document.getElementById('triggerFusion').addEventListener('click', runProtonChain);
        init();
    </script>
</body>
</html>