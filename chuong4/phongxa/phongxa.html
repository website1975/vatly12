<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mô phỏng Phóng xạ Hạt nhân</title>
    <!-- Tải Tailwind nhanh qua Play CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tải Chart.js với defer để không chặn rendering -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
    <!-- Cấu hình MathJax để load nhanh hơn và không chặn trang -->
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
            svg: { fontCache: 'global' },
            options: { skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'] }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <style>
        body {
            background-color: #020617;
            color: #f1f5f9;
            content-visibility: auto;
        }
        canvas {
            image-rendering: auto;
        }
        .nuclei-container {
            background: #000000;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
            min-height: 350px;
            border: 1px solid #1e293b;
        }
        .tab-active {
            border-bottom: 4px solid #3b82f6;
            color: #60a5fa;
            font-weight: bold;
            background-color: rgba(30, 41, 59, 0.5);
        }
        .hidden {
            display: none;
        }
        .math-block {
            background: #0f172a;
            padding: 1.25rem;
            border-radius: 0.5rem;
            border-left: 4px solid #3b82f6;
            margin: 1rem 0;
            color: #e2e8f0;
        }
    </style>
</head>
<body class="min-h-screen font-sans">
    <nav class="bg-slate-900 shadow-xl sticky top-0 z-50 border-b border-slate-800">
        <div class="max-w-6xl mx-auto flex">
            <!-- Đã sửa ID nút bấm để khớp với hàm switchTab -->
            <button onclick="switchTab('simulation')" id="tab-simulation-btn" class="flex-1 py-4 text-center text-slate-400 hover:text-white transition tab-active uppercase tracking-wider text-sm">
                Mô phỏng trực quan
            </button>
            <button onclick="switchTab('knowledge')" id="tab-knowledge-btn" class="flex-1 py-4 text-center text-slate-400 hover:text-white transition uppercase tracking-wider text-sm">
                Kiến thức vật lý
            </button>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto p-4 md:p-8">
        <section id="tab-simulation" class="space-y-6">
            <div class="bg-slate-900 p-6 rounded-xl shadow-2xl border-l-8 border-blue-600 border border-slate-800">
                <h1 class="text-3xl font-bold text-white">Mô phỏng Phóng xạ Hạt nhân</h1>
                <p class="text-slate-400 mt-1 italic font-light">Quan sát sự phân rã ngẫu nhiên của các hạt nhân.</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="bg-slate-900 p-6 rounded-xl space-y-6 border border-slate-800">
                    <h2 class="text-xl font-semibold border-b border-slate-700 pb-2 text-blue-400">Cấu hình</h2>
                    <div>
                        <label class="block text-sm font-medium text-slate-300">Số hạt ban đầu ($N_0$): <span id="n0-val" class="font-bold text-blue-400">800</span></label>
                        <input type="range" id="n0-slider" min="50" max="1500" value="800" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer mt-2 accent-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-300">Chu kỳ bán rã ($T$): <span id="t-val" class="font-bold text-blue-400">3</span> giây</label>
                        <input type="range" id="t-slider" min="0.5" max="10" step="0.5" value="3" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer mt-2 accent-blue-500">
                    </div>
                    <button id="start-btn" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 px-4 rounded-lg transition active:scale-95 uppercase tracking-wider">
                        Bắt đầu
                    </button>
                </div>

                <div class="lg:col-span-2 space-y-6">
                    <div class="bg-slate-900 p-6 rounded-xl border border-slate-800">
                        <div class="nuclei-container flex items-center justify-center">
                            <canvas id="nuclei-canvas"></canvas>
                        </div>
                        <div class="grid grid-cols-2 gap-4 mt-6">
                            <div class="bg-slate-950 p-4 rounded-lg text-center border border-slate-800">
                                <span class="block text-slate-500 text-xs uppercase font-bold">Thời gian (s)</span>
                                <span id="time-display" class="text-3xl font-mono font-bold text-blue-400">0.0</span>
                            </div>
                            <div class="bg-slate-950 p-4 rounded-lg text-center border border-slate-800">
                                <span class="block text-slate-500 text-xs uppercase font-bold">Còn lại (N)</span>
                                <span id="n-display" class="text-3xl font-mono font-bold text-green-400">800</span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-slate-900 p-6 rounded-xl border border-slate-800">
                        <div class="h-64"><canvas id="decay-chart"></canvas></div>
                    </div>
                </div>
            </div>
        </section>
        </section>

        <!-- Tab 2: Knowledge (Dark Mode Version) -->
        <section id="tab-knowledge" class="hidden space-y-8 animate-fade-in pb-12">
            <div class="bg-slate-900 p-8 rounded-xl shadow-2xl space-y-8 leading-relaxed text-slate-300 border border-slate-800">
                <h2 class="text-3xl font-bold text-white border-b-4 border-blue-600 pb-2 inline-block italic">Lý thuyết Phóng xạ</h2>
                
                <div class="space-y-4">
                    <h3 class="text-xl font-semibold text-blue-400">1. Phương trình biến thiên số hạt (\( N \))</h3>
                    <p>Số lượng hạt nhân còn lại tại thời điểm \( t \) được xác định bởi hàm mũ âm:</p>
                    <div class="math-block text-xl text-center shadow-inner">
                        \[ N(t) = N_0 \cdot e^{-\lambda t} = N_0 \cdot 2^{-\frac{t}{T}} \]
                    </div>
                    <p>Hằng số phóng xạ \( \lambda \) tỉ lệ nghịch với chu kỳ bán rã \( T \): \( \lambda = \frac{\ln 2}{T} \approx \frac{0,693}{T} \).</p>
                </div>

                <!-- Phân loại -->
                <div class="space-y-4">
                    <h3 class="text-xl font-semibold text-blue-400">2. Các loại bức xạ hạt nhân</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="p-4 bg-slate-950 border border-orange-900/30 rounded-lg">
                            <h4 class="font-bold text-orange-400 mb-1">Phóng xạ \( \alpha \) (Heli-4)</h4>
                            <p class="text-xs text-slate-500 mb-2 italic">Dòng hạt mang điện dương, khả năng đâm xuyên thấp.</p>
                            <div class="math-block bg-slate-900 text-center py-2 text-lg border-orange-500/50">
                                \[ ^A_Z X \rightarrow ^{A-4}_{Z-2} Y + ^4_2 He \]
                            </div>
                        </div>
                        <div class="p-4 bg-slate-950 border border-green-900/30 rounded-lg">
                            <h4 class="font-bold text-green-400 mb-1">Phóng xạ \( \beta^- \) (Electron)</h4>
                            <p class="text-xs text-slate-500 mb-2 italic">Biến đổi neutron thành proton trong hạt nhân.</p>
                            <div class="math-block bg-slate-900 text-center py-2 text-lg border-green-500/50">
                                \[ ^A_Z X \rightarrow ^A_{Z+1} Y + ^0_{-1} e + \bar{\nu} \]
                            </div>
                        </div>
                        <div class="p-4 bg-slate-950 border border-red-900/30 rounded-lg">
                            <h4 class="font-bold text-red-400 mb-1">Phóng xạ \( \beta^+ \) (Positron)</h4>
                            <p class="text-xs text-slate-500 mb-2 italic">Hạt nhân phát ra phản hạt của electron.</p>
                            <div class="math-block bg-slate-900 text-center py-2 text-lg border-red-500/50">
                                \[ ^A_Z X \rightarrow ^A_{Z-1} Y + ^0_{1} e + \nu \]
                            </div>
                        </div>
                        <div class="p-4 bg-slate-950 border border-purple-900/30 rounded-lg">
                            <h4 class="font-bold text-purple-400 mb-1">Phóng xạ \( \gamma \) (Photon)</h4>
                            <p class="text-xs text-slate-500 mb-2 italic">Sóng điện từ năng lượng cực cao, đâm xuyên mạnh.</p>
                            <div class="math-block bg-slate-900 text-center py-2 text-lg border-purple-500/50">
                                \[ ^A_Z X^* \rightarrow ^A_Z X + \gamma \]
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Độ phóng xạ -->
                <div class="bg-blue-900/10 p-6 rounded-xl border border-blue-900/30 shadow-inner">
                    <h3 class="text-xl font-semibold text-blue-400 mb-4 italic text-center underline underline-offset-8">3. Độ phóng xạ (\( H \))</h3>
                    <p class="mb-4 text-center">Đặc trưng cho số phân rã xảy ra trong mẫu vật sau mỗi giây.</p>
                    <div class="math-block text-2xl text-center bg-slate-950">
                        \[ H(t) = \lambda \cdot N(t) = H_0 \cdot e^{-\lambda t} \]
                    </div>
                    <div class="flex flex-wrap justify-center gap-4 mt-4">
                        <div class="px-4 py-2 bg-slate-800 rounded-full border border-slate-700 text-xs tracking-wider font-bold">
                            1 Bq = 1 phân rã / giây
                        </div>
                        <div class="px-4 py-2 bg-slate-800 rounded-full border border-slate-700 text-xs tracking-wider font-bold">
                            1 Ci = 37 tỷ Bq
                        </div>
                    </div>
                </div>

                <!-- Đồ thị phân tích -->
                <div class="space-y-4">
                    <h3 class="text-xl font-semibold text-blue-400 italic">4. Phân tích đồ thị tiệm cận</h3>
                    <div class="flex flex-col md:flex-row gap-8 items-center bg-slate-950 p-6 rounded-xl border border-slate-800">
                        <div class="flex-1 space-y-4">
                            <p>Đồ thị phóng xạ là một đường cong giảm dần, tiệm cận với trục thời gian:</p>
                            <div class="grid grid-cols-2 gap-2 text-sm font-mono">
                                <div class="p-2 bg-slate-900 rounded border border-slate-800">t = T \(\rightarrow\) N = N₀/2</div>
                                <div class="p-2 bg-slate-900 rounded border border-slate-800">t = 2T \(\rightarrow\) N = N₀/4</div>
                                <div class="p-2 bg-slate-900 rounded border border-slate-800">t = 3T \(\rightarrow\) N = N₀/8</div>
                                <div class="p-2 bg-slate-900 rounded border border-slate-800">t = nT \(\rightarrow\) N = N₀/2ⁿ</div>
                            </div>
                        </div>
                        <div class="w-full md:w-72 flex justify-center py-4">
                            <svg width="240" height="180" viewBox="0 0 240 180">
                                <!-- Axes -->
                                <path d="M 30 20 L 30 150 L 220 150" fill="none" stroke="#94a3b8" stroke-width="2"/>
                                <!-- Curve -->
                                <path d="M 30 40 Q 60 145 220 148" fill="none" stroke="#3b82f6" stroke-width="3" stroke-linecap="round"/>
                                <!-- Points & Labels -->
                                <circle cx="30" cy="40" r="3" fill="#f87171"/>
                                <text x="10" y="45" font-size="12" fill="#94a3b8">N₀</text>
                                <text x="180" y="165" font-size="12" fill="#94a3b8">thời gian</text>
                                <text x="210" y="145" font-size="10" fill="#3b82f6">N(t)</text>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <script>
        function switchTab(tabName) {
            // Ẩn tất cả các section
            document.getElementById('tab-simulation').classList.add('hidden');
            document.getElementById('tab-knowledge').classList.add('hidden');
            
            // Xóa class active khỏi tất cả các nút
            document.getElementById('tab-simulation-btn').classList.remove('tab-active');
            document.getElementById('tab-knowledge-btn').classList.remove('tab-active');
            
            // Hiển thị section và nút tương ứng
            const targetSection = document.getElementById('tab-' + tabName);
            const targetBtn = document.getElementById('tab-' + tabName + '-btn');
            
            if (targetSection) targetSection.classList.remove('hidden');
            if (targetBtn) targetBtn.classList.add('tab-active');
            
            if(tabName === 'simulation') resizeCanvas();
        }

        const n0Slider = document.getElementById('n0-slider');
        const tSlider = document.getElementById('t-slider');
        const nucleiCanvas = document.getElementById('nuclei-canvas');
        const ctxNuclei = nucleiCanvas.getContext('2d', { alpha: false });
        const chartCanvas = document.getElementById('decay-chart');

        let n0 = 800, halfLife = 3, currentTime = 0, nucleiList = [], animationId = null, decayChart = null;
        let historyN = [], historyT = [];

        function initChart() {
            if (decayChart) decayChart.destroy();
            if (typeof Chart !== 'undefined') {
                decayChart = new Chart(chartCanvas, {
                    type: 'line',
                    data: {
                        labels: historyT,
                        datasets: [{
                            label: 'Số hạt (N)',
                            data: historyN,
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            pointRadius: 0,
                            tension: 0.2
                        }]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false, animation: false,
                        scales: {
                            x: { grid: { color: '#1e293b' }, ticks: { color: '#64748b' } },
                            y: { min: 0, max: n0, grid: { color: '#1e293b' }, ticks: { color: '#64748b' } }
                        },
                        plugins: { legend: { labels: { color: '#e2e8f0' } } }
                    }
                });
            }
        }

        function resizeCanvas() {
            const container = nucleiCanvas.parentElement;
            if (container && container.clientWidth > 0) {
                nucleiCanvas.width = container.clientWidth;
                nucleiCanvas.height = container.clientHeight;
                drawNuclei();
            }
        }

        function createNuclei() {
            nucleiList = [];
            for (let i = 0; i < n0; i++) {
                nucleiList.push({
                    x: 15 + Math.random() * (nucleiCanvas.width - 30),
                    y: 15 + Math.random() * (nucleiCanvas.height - 30),
                    decayed: false
                });
            }
        }

        function drawNuclei() {
            ctxNuclei.fillStyle = '#000';
            ctxNuclei.fillRect(0, 0, nucleiCanvas.width, nucleiCanvas.height);
            
            ctxNuclei.fillStyle = '#22c55e';
            for(let p of nucleiList) {
                if (!p.decayed) {
                    ctxNuclei.beginPath();
                    ctxNuclei.arc(p.x, p.y, 2.5, 0, 6.28);
                    ctxNuclei.fill();
                }
            }
        }

        function updateStep() {
            const dt = 0.1; 
            currentTime += dt;
            const lambda = 0.693 / halfLife;
            const pDecay = 1 - Math.exp(-lambda * dt);
            let rem = 0;
            
            for (let p of nucleiList) {
                if (!p.decayed) {
                    if (Math.random() < pDecay) p.decayed = true;
                    else rem++;
                }
            }

            document.getElementById('time-display').innerText = currentTime.toFixed(1);
            document.getElementById('n-display').innerText = rem;
            historyT.push(currentTime.toFixed(1));
            historyN.push(rem);
            if (decayChart) decayChart.update('none');
            drawNuclei();

            if (rem > 0 && currentTime < 500) animationId = setTimeout(updateStep, 100);
        }

        n0Slider.oninput = () => {
            document.getElementById('n0-val').innerText = n0Slider.value;
            resetSim();
        };
        tSlider.oninput = () => {
            document.getElementById('t-val').innerText = tSlider.value;
            halfLife = parseFloat(tSlider.value);
        };

        function resetSim() {
            clearTimeout(animationId);
            n0 = parseInt(n0Slider.value);
            halfLife = parseFloat(tSlider.value);
            currentTime = 0;
            historyN = [n0]; historyT = ["0.0"];
            document.getElementById('time-display').innerText = "0.0";
            document.getElementById('n-display').innerText = n0;
            resizeCanvas();
            createNuclei();
            drawNuclei();
            initChart();
        }

        document.getElementById('start-btn').onclick = () => { resetSim(); updateStep(); };

        window.onload = () => {
            resizeCanvas();
            resetSim();
        };
        window.onresize = resizeCanvas;
    </script>
</body>
</html>