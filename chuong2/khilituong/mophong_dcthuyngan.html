<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√¥ Ph·ªèng Qu√° Tr√¨nh Nhi·ªát ƒê·ªô ƒê·∫°t C·ª±c ƒê·∫°i</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- TH√äM MATHJAX ƒê·ªÇ HI·ªÇN TH·ªä C√îNG TH·ª®C -->
        <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                // Ensure MathJax is ready before trying to typeset
                renderActions: {
                    add: [
                        10, 
                        (doc) => { 
                            if (!doc.typesetRoot) return;
                            doc.typeset();
                        },
                        100,
                    ]
                },
            }
        };
    </script>

    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            color: #1e293b;
        }
        #tube-container {
            width: 80px;
            height: 350px; /* Scale for L_TOTAL = 175cm (175*2 = 350) */
            background-color: #e2e8f0;
            border: 3px solid #64748b;
            border-top: none;
            border-radius: 0 0 8px 8px; 
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* Th√™m ph·∫ßn ƒë√°y b·ªãt k√≠n gi·∫£ */
        #sealed-bottom-cap {
            position: absolute;
            bottom: -3px; 
            left: -3px;
            width: 100%;
            height: 6px;
            background-color: #334155; 
            border-radius: 0 0 8px 8px;
            z-index: 100; 
            border: 3px solid #64748b;
            border-top: none;
        }
        
        #mercury-column {
            position: absolute;
            width: 100%;
            background-color: #4b5563; 
            transition: all 0.3s ease-out; 
            z-index: 10;
        }
        
        #dead-space {
            position: absolute;
            top: 0;
            width: 100%;
            background-color: transparent;
            z-index: 15;
            transition: height 0.3s ease-out;
            border-bottom: 2px dashed #9ca3af; /* Marker for the top of the mercury */
        }
        #dead-space-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            white-space: nowrap;
        }
        /* Nh√£n ƒë·ªÉ ƒë√°nh d·∫•u m·ªëc 175cm */
        #fixed-level-label {
            position: absolute;
            top: 0; 
            right: 85px; /* Outside the tube */
            font-size: 0.75rem;
            color: #0d9488;
            font-weight: bold;
            white-space: nowrap;
            transition: top 0.3s ease-out;
        }

        #air-column {
            position: absolute;
            bottom: 0; 
            width: 100%;
            background-color: #e0f2f1; 
            border-top: 2px solid #334155; 
            transition: height 0.3s ease-out;
            z-index: 5;
        }
        #air-label {
            position: absolute;
            width: 100%;
            text-align: center;
            color: #164e63;
            font-weight: bold;
            font-size: 0.8rem;
            z-index: 7;
        }
        .mercury-color {
            color: #4b5563;
        }
        .air-color {
            color: #164e63;
        }

        /* Styles for Gas Particles */
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background-color: rgba(255, 0, 0, 0.7); 
            z-index: 8;
            opacity: 0.8;
            filter: blur(0.5px);
        }

        /* Tmax visual indicator */
        .tmax-highlight {
            background-color: #fecaca; 
            color: #dc2626;
            border-color: #f87171;
        }
        .phase-indicator {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 4px;
        }
        /* Style for the explanation section */
        .explanation-section h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1d4ed8; 
            margin-top: 2rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #93c5fd;
        }
        .explanation-section h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #059669;
            margin-top: 1.5rem;
        }
        .explanation-section h4 {
            font-size: 1.1rem;
            font-weight: 500;
            color: #2563eb;
            margin-top: 1rem;
        }
        .explanation-section p {
            margin-bottom: 1rem;
            line-height: 1.6;
            color: #374151;
        }
        .explanation-section .math-formula {
            display: block;
            margin: 1rem 0;
            padding: 0.5rem;
            background-color: #eff6ff;
            border-left: 4px solid #3b82f6;
            font-family: 'Times New Roman', serif; /* Or MathJax if available */
            font-size: 1.1rem;
            text-align: center;
        }
        .explanation-section strong {
            font-weight: 700;
            color: #1e293b;
        }
        #temperatureChart {
            max-height: 400px; /* Limit chart height */
        }
    </style>
</head>
<body class="p-4 md:p-8 flex flex-col items-center min-h-screen">

    <div class="max-w-4xl w-full bg-white p-6 md:p-10 rounded-xl shadow-2xl">
        <h1 class="text-2xl font-extrabold text-indigo-700 mb-4 text-center">
            üß™ M√¥ Ph·ªèng Nhi·ªát ƒê·ªông H·ªçc: $T_{max}$ ·ªêng ƒê·ª©ng B·ªãt ƒê√°y
        </h1>
	<p style = "color: blue; font-size: 12px; text-align:center;" >
		M·ªôt ·ªëng thu·ª∑ tinh d√†i L, b√™n trong c√≥ c·ªôt thu·ª∑ ng√¢n cao h, ph√≠a tr√™n ƒë·ªÉ h·ªü, khi nung n√≥ng kh√≠, c·ªôt thu·ª∑ ng√¢n di chuy·ªÉn v√† tr√†n ra ngo√†i, H√£y quan s√°t s·ª± thay ƒë·ªïi nhi·ªát ƒë·ªô kh√≠ trong ·ªëng, khi c·ªôt thu·ª∑ ng√¢n di chuy·ªÉn
	</p>
        <p class="text-sm text-center text-gray-600 mb-6">
		ƒêi·ªÅu khi·ªÉn s·ª± gi√£n n·ªü ($L$) c·ªßa kh·ªëi kh√≠ trong ·ªëng **$175 \text{ cm}$** ƒë·ªÉ quan s√°t s·ª± thay ƒë·ªïi Nhi·ªát ƒë·ªô theo hai giai ƒëo·∫°n: **L·∫•p ƒë·∫ßy kho·∫£ng tr·ªëng** ($L \le 100 \text{ cm}$) v√† **Th·ªßy ng√¢n tr√†o** ($L > 100 \text{ cm}$).
        </p>

        <div class="grid md:grid-cols-2 gap-8 items-start">
            

<div class="flex flex-col space-y-4 p-4 bg-indigo-50 rounded-lg shadow-inner">
                <h2 class="text-xl font-semibold text-indigo-600 mb-2">ƒêi·ªÅu Khi·ªÉn v√† D·ªØ Li·ªáu</h2>

                

<div class="flex flex-col">
                    <label for="length-slider" class="text-sm font-medium text-gray-700 mb-1">
                        ƒêi·ªÅu khi·ªÉn Chi·ªÅu d√†i Kh√≠ ($L$): <span id="current-length-air" class="font-bold text-lg air-color"></span> cm
                        <span id="phase-status" class="phase-indicator bg-teal-100 text-teal-800"></span>
                    </label>
                    
                    <input type="range" id="length-slider" min="90" max="175" value="90" step="0.5" class="w-full h-2 bg-indigo-200 rounded-lg appearance-none cursor-pointer">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        

<span>$L_{min} = 90 \text{ cm}$ ($T \approx -6.00^\circ\text{C}$)</span>
                        <span class="text-indigo-600 font-bold">$L_{spill} = 100 \text{ cm}$ ($T \approx 23.66^\circ\text{C}$)</span>
                        <span class="text-red-600 font-bold">$L_{peak} = 125 \text{ cm}$ ($T_{max} \approx 36.03^\circ\text{C}$)</span>
                    </div>
                </div>

                

<div class="space-y-2 pt-4 border-t border-indigo-200">
                    <p class="text-md"><span class="font-bold text-gray-800">Nhi·ªát ƒë·ªô ($T$ Celsius):</span> <span id="current-temp-c" class="font-mono font-bold text-lg text-red-600"></span></p>
                    <p class="text-md"><span class="font-bold text-gray-800">Th·ªßy ng√¢n c√≤n l·∫°i ($h_{Hg}$):</span> <span id="length-mercury" class="mercury-color font-mono"></span> cm</p>
                    <p class="text-md"><span class="font-bold text-gray-800">√Åp su·∫•t kh√≠ ($P$):</span> <span id="pressure-air" class="font-mono text-gray-800"></span> cmHg</p>
                    <p class="text-md"><span class="font-bold text-gray-800">Kho·∫£ng tr·ªëng ($D$):</span> <span id="dead-space-length" class="font-mono text-gray-600"></span> cm</p>
                    <p class="text-md"><span class="font-bold text-gray-800">Nhi·ªát ƒë·ªô ($T$ Kelvin):</span> <span id="current-temp-k" class="font-mono text-gray-600"></span> K</p>
                </div>

                

<div id="tmax-info" class="mt-4 p-3 border-l-4 border-red-500 rounded-md bg-red-100">
                    <p class="font-semibold text-red-700">ƒêi·ªÉm C·ª±c ƒê·∫°i Tuy·ªát ƒê·ªëi ($T_{max}$):</p>
                    <p class="font-bold text-red-800">
                        ƒê·∫°t ƒë∆∞·ª£c t·∫°i $L = 125 \text{ cm}$ (Trong Giai ƒëo·∫°n Tr√†o)
                    </p>
                    <p class="font-bold text-red-800">
                        $T_{max} \approx 36.03^\circ\text{C}$ (K·∫øt qu·∫£ ƒë√£ s·ª≠a l·ªói l√†m tr√≤n)
                    </p>
                </div>
            </div>

            

<div class="flex flex-col items-center">
                <h2 class="text-xl font-semibold text-indigo-600 mb-4">Tr·ª±c Quan H√≥a ·ªêng Th·ªßy Tinh (175cm)</h2>

                

<div class="text-lg font-bold text-gray-700 mb-1 p-1 border-2 border-gray-400 rounded-t-lg bg-gray-200">
                    Mi·ªáng ·ªêng H·ªü ($P_0 = 75 \text{ cmHg}$)
                </div>

                <div id="tube-container">
                    

<div id="fixed-level-label">
                        M√©p ·ªëng (175cm) - B·∫Øt ƒë·∫ßu tr√†o khi $L = 100 \text{ cm}$
                    </div>

                    

<div id="dead-space" class="flex flex-col justify-center items-center">
                        <span id="dead-space-label" class="text-xs text-gray-800 font-medium"></span>
                    </div>

                    

<div id="mercury-column" class="flex flex-col justify-end">
                        <div class="text-xs font-bold text-white text-center p-1 bg-gray-600">
                            $h_{Hg}$
                        </div>
                    </div>
                    
                    

<div id="air-column">
                        <div id="air-label">L (Kh√¥ng Kh√≠)</div>
                        <div id="particle-container" class="absolute inset-0 top-0"></div>
                    </div>
                    
                    

<div id="sealed-bottom-cap"></div>
                </div>

                <div class="text-sm font-bold text-gray-700 mt-2">
                    ƒê√°y ·ªêng B·ªãt K√≠n (Kh·ªëi kh√≠ ban ƒë·∫ßu)
                </div>
            </div>
        </div>
        <div class="text-xs text-gray-500 mt-4 text-center">
            <span class="mercury-color">‚Äî Th·ªßy Ng√¢n ƒë·∫≠m</span> | <span class="air-color">‚Äî Kh√≠ (Ph√¢n t·ª≠ chuy·ªÉn ƒë·ªông)</span>
        </div>
    </div>
    
    

<div class="max-w-4xl w-full bg-white p-6 md:p-10 mt-8 rounded-xl shadow-2xl">
        <h2 class="text-2xl font-extrabold text-blue-700 mb-4 text-center">
            ƒê·ªì Th·ªã Nhi·ªát ƒê·ªô ($T$) theo Chi·ªÅu d√†i Kh√≠ ($L$)
        </h2>
        <div class="relative w-full">
            <canvas id="temperatureChart"></canvas>
        </div>
    </div>

    

<div class="max-w-4xl w-full bg-white p-6 md:p-10 mt-8 rounded-xl shadow-2xl explanation-section">
        <h2 class="text-2xl font-extrabold text-blue-700 mb-4 text-center">
            üå°Ô∏è Ph√¢n T√≠ch Nhi·ªát ƒê·ªô ƒê·∫°t C·ª±c ƒê·∫°i ($T_{max}$)
        </h2>
        
        <p>
            Hi·ªán t∆∞·ª£ng nhi·ªát ƒë·ªô ($T$) c·ªßa kh·ªëi kh√≠ tƒÉng r·ªìi gi·∫£m xu·ªëng trong qu√° tr√¨nh gi√£n n·ªü ƒë∆∞·ª£c gi·∫£i th√≠ch th√¥ng qua **Nguy√™n l√Ω I Nhi·ªát ƒë·ªông l·ª±c h·ªçc** ($\Delta U = Q + W$) v√† **Ph∆∞∆°ng tr√¨nh tr·∫°ng th√°i kh√≠ l√Ω t∆∞·ªüng** ($PV/T = \text{const}$).
        </p>

        <p>C√¥ng th·ª©c c·ªët l√µi quy·∫øt ƒë·ªãnh nhi·ªát ƒë·ªô ($T$) l√†:</p>
        <div class="math-formula">
            $$T = \frac{1}{K} \cdot P \cdot L$$
        </div>
        <p>Trong ƒë√≥: $K$ l√† h·∫±ng s·ªë, $P$ l√† √°p su·∫•t, v√† $L$ l√† chi·ªÅu d√†i (t·ª©c Th·ªÉ t√≠ch $V$) c·ªßa kh·ªëi kh√≠. Nhi·ªát ƒë·ªô tƒÉng hay gi·∫£m ph·ª• thu·ªôc v√†o s·ª± thay ƒë·ªïi ƒë·ªìng th·ªùi c·ªßa $P$ v√† $L$.</p>

        ---
        <h3>I. Giai ƒëo·∫°n TƒÉng Nhi·ªát ƒë·ªô ($L \le 125 \text{ cm}$): **Nhi·ªát c·∫•p v√†o l·ªõn h∆°n C√¥ng th·ª±c hi·ªán**</h3>

        <p>Nhi·ªát ƒë·ªô tƒÉng trong to√†n b·ªô Giai ƒëo·∫°n 1 ($90 \text{ cm} \to 100 \text{ cm}$) v√† n·ª≠a ƒë·∫ßu Giai ƒëo·∫°n 2 ($100 \text{ cm} \to 125 \text{ cm}$).</p>

        <h4>1. Giai ƒëo·∫°n L·∫•p ƒë·∫ßy Kho·∫£ng tr·ªëng ($90 \text{ cm} \le L \le 100 \text{ cm}$)</h4>
        <ul class="list-disc list-inside ml-4 space-y-2">
            <li>**√Åp su·∫•t ($P$):** **C·ªë ƒë·ªãnh** ($P = P_0 + H_{Hg} = 150 \text{ cmHg}$) v√¨ c·ªôt th·ªßy ng√¢n $H_{Hg}$ ch∆∞a b·ªã gi·∫£m chi·ªÅu d√†i.</li>
            <li>**K·∫øt qu·∫£:** $T$ t·ª∑ l·ªá thu·∫≠n v·ªõi $L$. Khi $L$ tƒÉng, $T$ tƒÉng tuy·∫øn t√≠nh.</li>
            <li>**Gi·∫£i th√≠ch NƒÉng l∆∞·ª£ng (ƒêL I NƒêLH):** Kh·ªëi kh√≠ nh·∫≠n nhi·ªát ($Q > 0$) v√† th·ª±c hi·ªán c√¥ng ($W > 0$) ƒë·ªÉ n√¢ng c·ªôt th·ªßy ng√¢n. V√¨ **$T$ tƒÉng ($\Delta U > 0$**), ƒëi·ªÅu n√†y ch·ª©ng t·ªè **t·ªëc ƒë·ªô Nhi·ªát nƒÉng c·∫•p v√†o ($Q$) l·ªõn h∆°n t·ªëc ƒë·ªô C√¥ng th·ª±c hi·ªán ($W$)**. NƒÉng l∆∞·ª£ng d∆∞ th·ª´a chuy·ªÉn th√†nh N·ªôi nƒÉng.</li>
        </ul>

        <h4>2. N·ª≠a ƒë·∫ßu Giai ƒëo·∫°n Tr√†o ($100 \text{ cm} < L \le 125 \text{ cm}$)</h4>
        <ul class="list-disc list-inside ml-4 space-y-2">
            <li>**C∆° ch·∫ø:** Th·ªßy ng√¢n tr√†o ra, l√†m gi·∫£m chi·ªÅu cao c·ªôt $H_{Hg}$ v√† gi·∫£m √°p su·∫•t $P$. Kh√≠ ti·∫øp t·ª•c gi√£n n·ªü ($L$ tƒÉng).</li>
            <li>**K·∫øt qu·∫£:** C·∫£ $P$ v√† $L$ ƒë·ªÅu thay ƒë·ªïi, nh∆∞ng s·ª± **tƒÉng c·ªßa $L$ v·∫´n chi·∫øm ∆∞u th·∫ø h∆°n** s·ª± gi·∫£m c·ªßa $P$, l√†m cho t√≠ch $P \cdot L$ (v√† do ƒë√≥ $T$) ti·∫øp t·ª•c tƒÉng.</li>
        </ul>

        ---
        <h3>II. Giai ƒëo·∫°n Gi·∫£m Nhi·ªát ƒë·ªô ($L > 125 \text{ cm}$): **C√¥ng th·ª±c hi·ªán tr·ªü n√™n chi·∫øm ∆∞u th·∫ø**</h3>

        <p>Nhi·ªát ƒë·ªô ƒë·∫°t **c·ª±c ƒë·∫°i tuy·ªát ƒë·ªëi** t·∫°i $L = 125 \text{ cm}$. Sau ƒëi·ªÉm n√†y, nhi·ªát ƒë·ªô b·∫Øt ƒë·∫ßu gi·∫£m m·∫∑c d√π kh·ªëi kh√≠ v·∫´n ƒëang gi√£n n·ªü ($L$ v·∫´n tƒÉng) v√† v·∫´n nh·∫≠n nhi·ªát.</p>

        <h4>Gi·∫£i th√≠ch t·∫°i sao $T$ gi·∫£m:</h4>
        <ul class="list-disc list-inside ml-4 space-y-2">
            <li>**S·ª± M·∫•t √Åp su·∫•t:** Th·ªßy ng√¢n tr√†o ra l√†m **√°p su·∫•t $P$ gi·∫£m r·∫•t m·∫°nh** theo $P = 250 - L$.</li>
            <li>**C√¢n b·∫±ng $P \cdot L$:** T·ªëc ƒë·ªô gi·∫£m c·ªßa $P$ ƒë√£ **v∆∞·ª£t qua** t·ªëc ƒë·ªô tƒÉng c·ªßa $L$.</li>
            <li>**C√¥ng v√† N·ªôi nƒÉng (ƒêL I NƒêLH)::** Kh√≠ v·∫´n nh·∫≠n nhi·ªát ($Q > 0$) nh∆∞ng c√¥ng su·∫•t ti√™u hao ƒë·ªÉ gi√£n n·ªü ($W$) v∆∞·ª£t tr·ªôi h∆°n t·ªëc ƒë·ªô tƒÉng N·ªôi nƒÉng do $Q$. D·∫´n ƒë·∫øn **N·ªôi nƒÉng gi·∫£m ($\Delta U < 0$)**, t·ª©c l√† **nhi·ªát ƒë·ªô $T$ gi·∫£m**.</li>
        </ul>

        <p class="mt-4 p-3 border-t border-b border-indigo-200 bg-indigo-50 font-semibold text-indigo-700 rounded-lg">
            **T√≥m l·∫°i:** $T_{max}$ ƒë·∫°t ƒë∆∞·ª£c t·∫°i ƒëi·ªÉm c√¢n b·∫±ng ho√†n h·∫£o, n∆°i m√† hi·ªáu ·ª©ng tƒÉng nhi·ªát ƒë·ªô do gi√£n n·ªü th·ªÉ t√≠ch ($L$) c√¢n b·∫±ng ch√≠nh x√°c v·ªõi hi·ªáu ·ª©ng gi·∫£m nhi·ªát ƒë·ªô do m·∫•t √°p su·∫•t ($P$).
        </p>

    </div>
    

<script>
        // --- KHAI B√ÅO H·∫∞NG S·ªê V√Ä BI·∫æN S·ªê BAN ƒê·∫¶U ---
        const L_TOTAL = 175; // Chi·ªÅu d√†i t·ªïng c·ªông c·ªßa ·ªëng (cm)
        const P0 = 75; // √Åp su·∫•t kh√≠ quy·ªÉn (cmHg)
        const L1 = 90; // Chi·ªÅu d√†i kh√≠ ban ƒë·∫ßu (cm)
        const H_INITIAL = 75; // Chi·ªÅu d√†i th·ªßy ng√¢n ban ƒë·∫ßu (cm)
        const D_INITIAL = L_TOTAL - L1 - H_INITIAL; // 10 cm
        const T1_C = -6; // Nhi·ªát ƒë·ªô ban ƒë·∫ßu (¬∞C)
        const T1_K = T1_C + 273.15; // 267.15 K
        
        // P1 = P0 + H_INITIAL = 75 + 75 = 150 cmHg
        const P1 = P0 + H_INITIAL; 
        
        // H·∫±ng s·ªë c·ªßa qu√° tr√¨nh (PV/T): D√πng gi√° tr·ªã ch√≠nh x√°c nh·∫•t
        const K_CONST = (P1 * L1) / T1_K; // K_CONST ‚âà 50.536096
        const PARTICLE_COUNT = 5; 
        
        // T_max (Giai ƒëo·∫°n tr√†o)
        const L_START_SPILL = L_TOTAL - H_INITIAL; // 175 - 75 = 100 cm
        const L_MAX_T = 125; // L = (P0 + L_TOTAL) / 2 = 125 cm
        const H_MAX_T = L_TOTAL - L_MAX_T; // 175 - 125 = 50 cm
        const P_MAX_T = P0 + H_MAX_T; // 75 + 50 = 125 cmHg
        
        // T√≠nh to√°n T_max ch√≠nh x√°c
        const T_MAX_K = (P_MAX_T * L_MAX_T) / K_CONST; // T_MAX_K ‚âà 309.18425 K
        const T_MAX_C = T_MAX_K - 273.15; // T_MAX_C ‚âà 36.03425 ¬∞C

        // Tr·∫°ng th√°i cu·ªëi (Hg tr√†n h·∫øt)
        const L_END = L_TOTAL; // 175 cm (Gi·ªõi h·∫°n l√Ω thuy·∫øt)
        const T_END_K = (P0 * L_END) / K_CONST; 
        const T_END_C = T_END_K - 273.15; 


        // C√°c ph·∫ßn t·ª≠ DOM
        const lengthSlider = document.getElementById('length-slider'); 
        const currentLengthAir = document.getElementById('current-length-air');
        const currentTempC = document.getElementById('current-temp-c');
        const currentTempK = document.getElementById('current-temp-k');
        const lengthMercury = document.getElementById('length-mercury');
        const pressureAir = document.getElementById('pressure-air');
        const deadSpaceLength = document.getElementById('dead-space-length');
        const airColumn = document.getElementById('air-column');
        const mercuryColumn = document.getElementById('mercury-column');
        const deadSpaceDiv = document.getElementById('dead-space');
        const deadSpaceLabel = document.getElementById('dead-space-label');
        const airLabel = document.getElementById('air-label');
        const tubeContainer = document.getElementById('tube-container');
        const particleContainer = document.getElementById('particle-container');
        const tmaxInfo = document.getElementById('tmax-info');
        const fixedLevelLabel = document.getElementById('fixed-level-label');
        const phaseStatus = document.getElementById('phase-status');

        let particles = [];
        let animationFrameId;
        let temperatureChart; // Bi·∫øn ƒë·ªÉ l∆∞u tr·ªØ ƒë·ªëi t∆∞·ª£ng ƒë·ªì th·ªã

        // --- H√ÄM T·∫†O V√Ä C·∫¨P NH·∫¨T PH√ÇN T·ª¨ KH√ç (Kh√¥ng thay ƒë·ªïi) ---
        function createParticles() {
            particleContainer.innerHTML = '';
            particles = [];
            
            for (let i = 0; i < PARTICLE_COUNT; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                p.style.left = `${Math.random() * 80 + 10}%`; 
                const initialHeightPx = L1 / L_TOTAL * tubeContainer.offsetHeight;
                p.style.bottom = `${Math.random() * initialHeightPx}px`; 
                
                particles.push({
                    element: p,
                    vx: (Math.random() - 0.5) * 0.5, 
                    vy: (Math.random() - 0.5) * 0.5, 
                });
                particleContainer.appendChild(p);
            }
        }

        function animateParticles() {
            const containerWidth = tubeContainer.offsetWidth;
            const currentAirHeight = airColumn.offsetHeight;
            // S·ª≠ d·ª•ng T_MAX_K ƒë√£ t√≠nh to√°n ch√≠nh x√°c
            const tempInfluence = (parseFloat(currentTempK.textContent) / T_MAX_K); 

            particles.forEach(p => {
                let x = parseFloat(p.element.style.left) / 100 * containerWidth;
                let y = parseFloat(p.element.style.bottom);

                const speedMultiplier = 1 + tempInfluence * 0.8; 
                x += p.vx * speedMultiplier;
                y += p.vy * speedMultiplier;

                if (x < 0 || x > containerWidth) {
                    p.vx *= -1;
                }
                if (y < 0 || y > currentAirHeight) {
                    p.vy *= -1;
                }
                
                p.vx += (Math.random() - 0.5) * 0.05;
                p.vy += (Math.random() - 0.5) * 0.05;

                const maxV = 2; 
                p.vx = Math.min(maxV, Math.max(-maxV, p.vx));
                p.vy = Math.min(maxV, Math.max(-maxV, p.vy));
                
                p.element.style.left = `${x / containerWidth * 100}%`;
                p.element.style.bottom = `${y}px`;
            });

            animationFrameId = requestAnimationFrame(animateParticles);
        }

        // --- H√ÄM T√çNH TO√ÅN T(L) cho ƒë·ªì th·ªã ---
        function calculateTemperatureAtL(L_val) {
            let H_Hg_val, P_val;

            if (L_val <= L_START_SPILL) {
                // Giai ƒëo·∫°n 1: L·∫•p ƒë·∫ßy kho·∫£ng tr·ªëng (H_Hg c·ªë ƒë·ªãnh = 75 cm)
                H_Hg_val = H_INITIAL; 
                P_val = P1; 
            } else {
                // Giai ƒëo·∫°n 2: Th·ªßy ng√¢n tr√†o (ƒê·ªânh Hg c·ªë ƒë·ªãnh t·∫°i 175 cm)
                H_Hg_val = Math.max(0, L_TOTAL - L_val); 
                P_val = P0 + H_Hg_val; 
            }
            return (P_val * L_val) / K_CONST - 273.15; // Tr·∫£ v·ªÅ nhi·ªát ƒë·ªô Celsius
        }

        // --- H√ÄM KH·ªûI T·∫†O ƒê·ªí TH·ªä ---
        function initChart() {
            const ctx = document.getElementById('temperatureChart').getContext('2d');
            const dataPoints = [];
            for (let L = L1; L <= L_END; L += 1) { // L·∫•y m·∫´u v·ªõi b∆∞·ªõc 1cm
                dataPoints.push({ x: L, y: calculateTemperatureAtL(L) });
            }

            temperatureChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Nhi·ªát ƒë·ªô T (¬∞C)',
                        data: dataPoints,
                        borderColor: 'rgb(75, 192, 192)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        tension: 0.1,
                        fill: false,
                        pointRadius: 0 // Hide points on the line
                    },
                    {
                        label: 'V·ªã tr√≠ hi·ªán t·∫°i',
                        data: [{ x: parseFloat(lengthSlider.value), y: calculateTemperatureAtL(parseFloat(lengthSlider.value)) }],
                        borderColor: 'rgb(255, 99, 132)',
                        backgroundColor: 'rgb(255, 99, 132)',
                        pointRadius: 5,
                        pointHoverRadius: 7,
                        showLine: false
                    },
                    {
                        label: `Tmax (${T_MAX_C.toFixed(2)}¬∞C)`,
                        data: [{ x: L_MAX_T, y: T_MAX_C }],
                        borderColor: 'rgb(255, 205, 86)',
                        backgroundColor: 'rgb(255, 205, 86)',
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        showLine: false,
                        pointStyle: 'star'
                    },
                    {
                        label: `B·∫Øt ƒë·∫ßu tr√†o (${L_START_SPILL}cm)`,
                        data: [{ x: L_START_SPILL, y: calculateTemperatureAtL(L_START_SPILL) }],
                        borderColor: 'rgb(54, 162, 235)',
                        backgroundColor: 'rgb(54, 162, 235)',
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        showLine: false,
                        pointStyle: 'triangle'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            title: {
                                display: true,
                                text: 'Chi·ªÅu d√†i Kh√≠ L (cm)'
                            },
                            min: L1,
                            max: L_TOTAL
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Nhi·ªát ƒë·ªô T (¬∞C)'
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: L = ${context.parsed.x.toFixed(2)}cm, T = ${context.parsed.y.toFixed(2)}¬∞C`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // --- H√ÄM C·∫¨P NH·∫¨T ƒê·ªí TH·ªä ---
        function updateChart(L_cm, T_c) {
            if (temperatureChart) {
                temperatureChart.data.datasets[1].data = [{ x: L_cm, y: T_c }]; // C·∫≠p nh·∫≠t ƒëi·ªÉm hi·ªán t·∫°i
                temperatureChart.update();
            }
        }


        // --- H√ÄM T√çNH TO√ÅN V√Ä C·∫¨P NH·∫¨T (Input L, Output T) ---
        function calculateAndRender(L_cm) {
            
            let H_Hg, P, D, phase;
            
            if (L_cm <= L_START_SPILL) {
                // Giai ƒëo·∫°n 1: L·∫•p ƒë·∫ßy kho·∫£ng tr·ªëng (H_Hg c·ªë ƒë·ªãnh = 75 cm)
                phase = "Gƒê 1: L·∫•p Kho·∫£ng tr·ªëng";
                H_Hg = H_INITIAL; 
                P = P1; 
                D = L_TOTAL - L_cm - H_Hg; // Kho·∫£ng tr·ªëng gi·∫£m t·ª´ 10 cm v·ªÅ 0 cm
                
                // Gi·ªõi h·∫°n D kh√¥ng √¢m (D=0 khi L=100)
                D = Math.max(0, D); 

            } else {
                // Giai ƒëo·∫°n 2: Th·ªßy ng√¢n tr√†o (ƒê·ªânh Hg c·ªë ƒë·ªãnh t·∫°i 175 cm)
                phase = "Gƒê 2: Th·ªßy ng√¢n Tr√†o";
                D = 0; // Kho·∫£ng tr·ªëng = 0
                
                // Chi·ªÅu d√†i Hg gi·∫£m do tr√†o, kh√¥ng th·ªÉ √¢m
                H_Hg = Math.max(0, L_TOTAL - L_cm); 
                
                // √Åp su·∫•t gi·∫£m
                P = P0 + H_Hg; 
            }
            
            // T√≠nh T: T = (P * L) / K_CONST
            const T_K = (P * L_cm) / K_CONST;
            const T_C = T_K - 273.15;
            
            // 2. T√≠nh to√°n t·ª∑ l·ªá hi·ªÉn th·ªã
            const SCALE = tubeContainer.offsetHeight / L_TOTAL;
            const airHeight = L_cm * SCALE;
            const mercuryHeight = H_Hg * SCALE;
            const deadSpaceHeight = D * SCALE;
            
            // 3. C·∫≠p nh·∫≠t Giao Di·ªán (D·ªØ li·ªáu)
            currentLengthAir.textContent = L_cm.toFixed(2);
            lengthMercury.textContent = H_Hg.toFixed(2);
            pressureAir.textContent = P.toFixed(2);
            deadSpaceLength.textContent = D.toFixed(2);
            currentTempK.textContent = T_K.toFixed(2);
            currentTempC.textContent = `${T_C.toFixed(2)}¬∞C`;
            phaseStatus.textContent = phase;
            
            // ƒê√°nh d·∫•u T_max
            currentTempC.classList.remove('text-green-600', 'text-yellow-600', 'text-red-600');
            
            if (L_cm < L_MAX_T) {
                currentTempC.classList.add('text-green-600');
                tmaxInfo.classList.remove('tmax-highlight');
            } else if (L_cm >= L_MAX_T - 0.5 && L_cm <= L_MAX_T + 0.5) {
                currentTempC.classList.add('text-red-600');
                tmaxInfo.classList.add('tmax-highlight');
            } else {
                currentTempC.classList.add('text-yellow-600');
                tmaxInfo.classList.remove('tmax-highlight');
            }

            // 4. C·∫≠p nh·∫≠t M√¥ Ph·ªèng (Visuals)
            
            // C·∫≠p nh·∫≠t c·ªôt kh√≠: Lu√¥n ·ªü ƒë√°y
            airColumn.style.height = `${airHeight}px`;
            airLabel.style.bottom = `${airHeight / 2 - 8}px`; 
            particleContainer.style.height = `${airHeight}px`;

            // C·∫≠p nh·∫≠t c·ªôt th·ªßy ng√¢n: N·∫±m tr√™n c·ªôt kh√≠
            mercuryColumn.style.height = `${mercuryHeight}px`;
            mercuryColumn.style.bottom = `${airHeight}px`; 
            mercuryColumn.style.opacity = H_Hg < 0.1 ? '0.2' : '1'; // M·ªù ƒëi khi g·∫ßn h·∫øt
            
            // C·∫≠p nh·∫≠t kho·∫£ng tr·ªëng
            deadSpaceDiv.style.height = `${deadSpaceHeight}px`;
            deadSpaceDiv.style.bottom = `${airHeight + mercuryHeight}px`;
            
            // C·∫≠p nh·∫≠t nh√£n kho·∫£ng tr·ªëng
            if (D > 0.1) {
                deadSpaceLabel.innerHTML = `<span class="text-xs text-gray-800 font-medium">D = ${D.toFixed(2)} cm</span>`;
                deadSpaceDiv.style.opacity = '1';
                deadSpaceDiv.style.borderBottom = '2px dashed #9ca3af';
            } else {
                deadSpaceLabel.textContent = ``;
                deadSpaceDiv.style.opacity = '0';
                deadSpaceDiv.style.borderBottom = 'none';
            }

            // C·∫≠p nh·∫≠t tr·∫°ng th√°i pha cho nh√£n
            if (L_cm < L_START_SPILL) {
                 phaseStatus.classList.remove('bg-red-100', 'text-red-800');
                 phaseStatus.classList.add('bg-teal-100', 'text-teal-800');
            } else {
                 phaseStatus.classList.remove('bg-teal-100', 'text-red-800');
                 phaseStatus.classList.add('bg-red-100', 'text-red-800');
            }

            // C·∫≠p nh·∫≠t v·ªã tr√≠ h·∫°t
            if (particles.length > 0) {
                particles.forEach(p => {
                    let y = parseFloat(p.element.style.bottom);
                    if (y > airHeight) {
                        p.element.style.bottom = `${airHeight * Math.random()}px`;
                    }
                });
            }
            updateChart(L_cm, T_C); // C·∫≠p nh·∫≠t ƒë·ªì th·ªã
        }

        // --- X·ª¨ L√ù S·ª∞ KI·ªÜN ---
        lengthSlider.addEventListener('input', (e) => {
            const L_cm = parseFloat(e.target.value);
            requestAnimationFrame(() => calculateAndRender(L_cm));
        });

        // Kh·ªüi t·∫°o tr·∫°ng th√°i ban ƒë·∫ßu
        window.onload = () => {
             // Th√™m th√¥ng tin T_max v√†o ch√∫ th√≠ch (ƒê√£ s·ª≠a l·ªói l√†m tr√≤n)
             const minMaxDiv = document.querySelector('.flex.justify-between.text-xs.text-gray-500.mt-1');
             minMaxDiv.innerHTML = `
                <span>$L_{min} = 90 \text{ cm}$ ($T \approx ${T1_C.toFixed(2)}^\circ\text{C}$)</span>
                <span class="text-indigo-600 font-bold">$L_{spill} = 100 \text{ cm}$ ($T \approx 23.66^\circ\text{C}$)</span>
                <span class="text-red-600 font-bold">$L_{peak} = 125 \text{ cm}$ ($T_{max} \approx ${T_MAX_C.toFixed(2)}^\circ\text{C}$)</span>
             `;
             
             initChart(); // Kh·ªüi t·∫°o ƒë·ªì th·ªã tr∆∞·ªõc
             calculateAndRender(L1);
             createParticles();
             animateParticles();
        }

    </script>
</body>
</html>
