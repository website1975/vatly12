<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- TH√äM MATHJAX ƒê·ªÇ HI·ªÇN TH·ªä C√îNG TH·ª®C -->
        <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                // Ensure MathJax is ready before trying to typeset
                renderActions: {
                    add: [
                        10, 
                        (doc) => { 
                            if (!doc.typesetRoot) return;
                            doc.typeset();
                        },
                        100,
                    ]
                },
            }
        };
    </script>

    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <title>M√¥ Ph·ªèng Khinh Kh√≠ C·∫ßu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .balloon-container {
            /* ·∫®n overflow ƒë·ªÉ khinh kh√≠ c·∫ßu c√≥ th·ªÉ bay l√™n kh·ªèi m√†n h√¨nh */
            overflow: hidden;
            position: relative;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: flex-end; /* B·∫Øt ƒë·∫ßu t·ª´ d∆∞·ªõi */
        }
        .balloon-wrapper {
            transition: transform 3s ease-in-out; /* Hi·ªáu ·ª©ng di chuy·ªÉn m∆∞·ª£t m√† */
            position: absolute;
            bottom: 0;
            width: 150px; /* K√≠ch th∆∞·ªõc c·ªë ƒë·ªãnh */
            z-index: 10;
        }
        .balloon-basket {
            width: 40px;
            height: 30px;
            background-color: #6a4c3f;
            border-radius: 4px;
            margin: 0 auto;
            position: relative;
            z-index: 20;
        }
        .balloon-lines {
            width: 2px;
            height: 50px;
            background-color: #6a4c3f;
            position: absolute;
            bottom: 30px;
            left: calc(50% - 1px);
            z-index: 15;
        }
        .balloon-lines::before, .balloon-lines::after {
            content: '';
            position: absolute;
            width: 2px;
            height: 50px;
            background-color: #6a4c3f;
            transform: rotate(15deg);
            transform-origin: top center;
            top: 0;
        }
        .balloon-lines::before {
            left: -15px;
            transform: rotate(-15deg);
        }
        .balloon-lines::after {
            right: -15px;
            transform: rotate(15deg);
        }
        .balloon-envelope {
            width: 150px;
            height: 180px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ffe66d 50%, #4ecdc4 100%);
            border-radius: 50% 50% 10% 10% / 60% 60% 40% 40%;
            position: relative;
            margin-bottom: -10px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            z-index: 10;
            overflow: hidden;
        }
        .balloon-shadow {
            position: absolute;
            bottom: 0;
            left: 5%;
            width: 90%;
            height: 15px;
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            z-index: 5;
            filter: blur(5px);
            transition: opacity 3s ease-in-out;
        }

        /* -------------------------- */
        /* Custom styles for status UI */
        /* -------------------------- */
        .status-box {
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        /* Custom class cho hi·ªÉn th·ªã b∆∞·ªõc gi·∫£i */
        .calculation-step {
            padding: 8px 0;
            border-bottom: 1px dashed #e0e0e0;
        }
        .calculation-step:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <h1 class="text-3xl font-extrabold text-indigo-700 mb-6 text-center">M√¥ Ph·ªèng V·∫≠t L√Ω Khinh Kh√≠ C·∫ßu</h1>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 h-[75vh] bg-white rounded-xl shadow-2xl p-6">

            <!-- Ph·∫ßn 1: B·∫£ng ƒëi·ªÅu khi·ªÉn (Controls) -->
            <div class="control-panel space-y-6 overflow-y-auto">
                <h2 class="text-2xl font-bold text-indigo-600 border-b pb-2 mb-4">1. Th√¥ng S·ªë ƒê·∫ßu V√†o</h2>

                <div id="statusOutput" class="status-box bg-gray-100 p-4 rounded-lg shadow-inner">
                    <p class="text-xl font-semibold text-gray-700">ƒêang ch·ªù t√≠nh to√°n...</p>
                    <p id="netForceDisplay" class="text-sm mt-1 text-gray-500"></p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Input 1: Th·ªÉ t√≠ch -->
                    <label class="block">
                        <span class="text-sm font-medium text-gray-700">Th·ªÉ T√≠ch V·ªè (V, m¬≥)</span>
                        <input type="number" id="volume" value="1500" min="100" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                    </label>
                    <!-- Input 2: Kh·ªëi l∆∞·ª£ng v·ªè -->
                    <label class="block">
                        <span class="text-sm font-medium text-gray-700">Kh·ªëi L∆∞·ª£ng V·ªè (m_v·ªè, kg)</span>
                        <input type="number" id="shellMass" value="200" min="10" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                    </label>
                    <!-- Input 3: Nhi·ªát ƒë·ªô b√™n ngo√†i -->
                    <label class="block">
                        <span class="text-sm font-medium text-gray-700">Nhi·ªát ƒê·ªô Ngo√†i (T_ngo√†i, ¬∞C)</span>
                        <input type="number" id="outsideTemp" value="20" min="-50" max="50" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                    </label>
                    <!-- Input 4: √Åp su·∫•t -->
                    <label class="block">
                        <span class="text-sm font-medium text-gray-700">√Åp Su·∫•t (P, atm)</span>
                        <input type="number" id="pressure" value="1" min="0.5" max="2" step="0.01" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                    </label>
                    <!-- Input 5: Kh·ªëi l∆∞·ª£ng mol -->
                    <label class="block md:col-span-2">
                        <span class="text-sm font-medium text-gray-700">Kh·ªëi L∆∞·ª£ng Mol Kh√¥ng Kh√≠ (M, kg/mol)</span>
                        <input type="number" id="molarMass" value="0.02896" min="0.01" step="0.00001" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                        <p class="text-xs text-gray-500 mt-1">Gi√° tr·ªã ti√™u chu·∫©n cho kh√¥ng kh√≠ l√† 0.02896 kg/mol.</p>
                    </label>
                </div>

                <!-- Slider: Nhi·ªát ƒë·ªô b√™n trong -->
                <div class="pt-4 border-t">
                    <h3 class="text-xl font-bold text-indigo-600 mb-3">2. ƒêi·ªÅu Ch·ªânh Nhi·ªát ƒê·ªô B√™n Trong</h3>
                    <label class="block">
                        <span class="text-lg font-medium text-gray-700">Nhi·ªát ƒê·ªô B√™n Trong (T_trong): <span id="insideTempValue" class="text-2xl text-red-600 font-extrabold">100</span> ¬∞C</span>
                        <input type="range" id="insideTempSlider" min="20" max="150" value="100" step="1" class="w-full h-2 bg-indigo-100 rounded-lg appearance-none cursor-pointer range-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 mt-2">
                    </label>
                </div>
                
                <!-- Khu v·ª±c hi·ªÉn th·ªã chi ti·∫øt c√°c b∆∞·ªõc gi·∫£i -->
                <div class="pt-4 border-t">
                    <h3 class="text-xl font-bold text-indigo-600 mb-3">3. Ph√¢n T√≠ch V·∫≠t L√Ω Chi Ti·∫øt</h3>
                    <div id="calculationSteps" class="bg-gray-50 p-4 rounded-lg text-sm space-y-2">
                        <!-- N·ªôi dung s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t b·∫±ng JavaScript -->
                        ƒêang ch·ªù d·ªØ li·ªáu...
                    </div>
                </div>

            </div>

            <!-- Ph·∫ßn 2: H√¨nh ·∫£nh Khinh kh√≠ c·∫ßu v√† M√¥ ph·ªèng -->
            <div class="balloon-container bg-blue-100/50 rounded-lg shadow-inner relative">
                <div class="absolute inset-x-0 bottom-0 h-4 bg-green-500 z-50"></div>
                <div class="balloon-wrapper" id="balloonWrapper">
                    <!-- V·ªè Khinh kh√≠ c·∫ßu (Envelope) -->
                    <div class="balloon-envelope">
                        <!-- Hi·ªáu ·ª©ng √°nh l·ª≠a (Fire effect) -->
                        <div id="fireEffect" class="absolute bottom-0 left-1/2 -translate-x-1/2 w-8 h-8 rounded-full bg-orange-400 opacity-0 transition-opacity duration-300 shadow-[0_0_15px_5px_rgba(255,165,0,0.8)]"></div>
                    </div>
                    <!-- D√¢y treo (Lines) -->
                    <div class="balloon-lines"></div>
                    <!-- Gi·ªè (Basket) -->
                    <div class="balloon-basket"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // S·ª≠ d·ª•ng Immediately Invoked Function Expression (IIFE) ƒë·ªÉ t·∫°o ph·∫°m vi c·ª•c b·ªô
        // v√† tr√°nh l·ªói khai b√°o l·∫°i bi·∫øn trong m√¥i tr∆∞·ªùng th·ª±c thi.
        (function() {
            // H·∫±ng s·ªë v·∫≠t l√Ω (SI Units)
            const R = 8.314;        // Universal Gas Constant (J/(mol¬∑K))
            const g = 9.81;         // Acceleration due to gravity (m/s¬≤)
            const ATM_TO_PA = 101325; // Conversion: 1 atm to Pascals (Pa)
            const CELSIUS_TO_KELVIN = 273.15; // Conversion: Celsius to Kelvin

            // L·∫•y c√°c ph·∫ßn t·ª≠ DOM
            const volumeInput = document.getElementById('volume');
            const shellMassInput = document.getElementById('shellMass');
            const outsideTempInput = document.getElementById('outsideTemp');
            const pressureInput = document.getElementById('pressure');
            const molarMassInput = document.getElementById('molarMass');
            const insideTempSlider = document.getElementById('insideTempSlider');

            const insideTempValueDisplay = document.getElementById('insideTempValue');
            const statusOutput = document.getElementById('statusOutput');
            const netForceDisplay = document.getElementById('netForceDisplay');
            const balloonWrapper = document.getElementById('balloonWrapper');
            const fireEffect = document.getElementById('fireEffect');
            const calculationSteps = document.getElementById('calculationSteps');

            // H√†m chuy·ªÉn ƒë·ªïi t·ª´ ¬∞C sang K
            const toKelvin = (celsius) => parseFloat(celsius) + CELSIUS_TO_KELVIN;

            // H√†m t√≠nh to√°n v√† c·∫≠p nh·∫≠t tr·∫°ng th√°i
            function calculateAndAnimate() {
                // ƒê·ªçc v√† chuy·ªÉn ƒë·ªïi ƒë·∫ßu v√†o sang SI Units
                const V = parseFloat(volumeInput.value);               // m¬≥
                const m_shell = parseFloat(shellMassInput.value);       // kg
                const T_out_C = parseFloat(outsideTempInput.value);     // ¬∞C
                const P_atm = parseFloat(pressureInput.value);          // atm
                const M = parseFloat(molarMassInput.value);             // kg/mol
                const T_in_C = parseFloat(insideTempSlider.value);      // ¬∞C

                // C·∫≠p nh·∫≠t gi√° tr·ªã hi·ªÉn th·ªã c·ªßa thanh tr∆∞·ª£t
                insideTempValueDisplay.textContent = T_in_C.toFixed(0);

                // Chuy·ªÉn ƒë·ªïi sang SI Units (Kelvin, Pascal)
                const T_out_K = toKelvin(T_out_C);
                const T_in_K = toKelvin(T_in_C);
                const P = P_atm * ATM_TO_PA;

                // Ki·ªÉm tra c√°c gi√° tr·ªã c∆° b·∫£n (tr√°nh chia cho 0 ho·∫∑c NaN)
                if (isNaN(V) || isNaN(m_shell) || isNaN(T_out_K) || isNaN(T_in_K) || isNaN(P) || isNaN(M) || T_out_K <= 0 || T_in_K <= 0) {
                    statusOutput.innerHTML = '<p class="text-xl font-semibold text-red-600">L·ªói d·ªØ li·ªáu ƒë·∫ßu v√†o. Vui l√≤ng ki·ªÉm tra l·∫°i.</p>';
                    calculationSteps.innerHTML = 'L·ªói d·ªØ li·ªáu ƒë·∫ßu v√†o.';
                    return;
                }

                // =================================================================
                // B∆Ø·ªöC 1: T√≠nh M·∫≠t ƒë·ªô Kh√≠ B√™n Ngo√†i (D_out / rho_out) v√† L·ª±c ƒë·∫©y F_B
                // C√¥ng th·ª©c: D_out = (P * M) / (R * T_out)
                // =================================================================
                const rho_out = (P * M) / (R * T_out_K); // M·∫≠t ƒë·ªô kh√¥ng kh√≠ b√™n ngo√†i (kg/m¬≥)
                const F_B = rho_out * V * g; // L·ª±c ƒë·∫©y Archimedes (N)
                
                // =================================================================
                // B∆Ø·ªöC 2: ƒêi·ªÅu ki·ªán C√ÇN B·∫∞NG - Kh·ªëi l∆∞·ª£ng kh√≠ T·ªêI THI·ªÇU c·∫ßn thi·∫øt (m_k, c·∫ßn)
                // C√¥ng th·ª©c: m_k, c·∫ßn = D_out * V - m_v·ªè
                // T∆∞∆°ng ƒë∆∞∆°ng v·ªõi ƒêK Bay: D_out * V >= m_v·ªè + m_k
                // =================================================================
                const m_k_required = (rho_out * V) - m_shell; // Kh·ªëi l∆∞·ª£ng kh√≠ c·∫ßn ƒë·ªÉ c√¢n b·∫±ng (F_net = 0)

                // T√≠nh Nhi·ªát ƒë·ªô c·∫•t c√°nh t·ªëi thi·ªÉu (T_in, min)
                let T_in_min_C;
                let m_k_required_safe = m_k_required > 0 ? m_k_required : 0.000001; // Tr√°nh chia cho 0 ho·∫∑c gi√° tr·ªã √¢m
                
                // C√¥ng th·ª©c: T_in, min = (P * M * V) / (R * m_k, c·∫ßn)
                if (m_k_required > 0) {
                    let T_in_min_K = (P * M * V) / (R * m_k_required);
                    T_in_min_C = T_in_min_K - CELSIUS_TO_KELVIN;
                } else {
                    // N·∫øu m_v·ªè qu√° n·∫∑ng (rho_out * V <= m_shell), th√¨ kh√¥ng th·ªÉ bay ƒë∆∞·ª£c
                    T_in_min_C = Infinity;
                }

                // =================================================================
                // B∆Ø·ªöC 3: T√≠nh Kh·ªëi l∆∞·ª£ng Kh√≠ Trong TH·ª∞C T·∫æ (m_k, th·ª±c) v√† Tr·ªçng l·ª±c F_g
                // C√¥ng th·ª©c: T_in (K) => rho_in = (P * M) / (R * T_in)
                // m_k, th·ª±c = rho_in * V
                // =================================================================
                const rho_in = (P * M) / (R * T_in_K);   // M·∫≠t ƒë·ªô kh√¥ng kh√≠ b√™n trong (kg/m¬≥)
                const m_gas_in_actual = rho_in * V;             // Kh·ªëi l∆∞·ª£ng kh√≠ n√≥ng th·ª±c t·∫ø b√™n trong (kg)
                const m_total = m_shell + m_gas_in_actual;      // T·ªïng kh·ªëi l∆∞·ª£ng (v·ªè + kh√≠ n√≥ng th·ª±c t·∫ø) (kg)
                const F_g = m_total * g;                 // Tr·ªçng l·ª±c (N)
                
                // =================================================================
                // K·∫æT LU·∫¨N: T√≠nh L·ª±c r√≤ng (F_net)
                // =================================================================
                const F_net = F_B - F_g;     // L·ª±c r√≤ng (N)


                // =================================================================
                // C·∫≠p nh·∫≠t giao di·ªán Tr·∫°ng th√°i v√† Ho·∫°t ·∫£nh
                // =================================================================

                let statusText;
                let netForceText = `L·ª±c ƒë·∫©y (F_B): ${F_B.toFixed(0)} N | Tr·ªçng l·ª±c (F_g): ${F_g.toFixed(0)} N`;
                let fireOpacity = 0;
                let translateY = 0; 

                if (F_net > 0) {
                    statusOutput.classList.remove('bg-gray-100', 'bg-yellow-100');
                    statusOutput.classList.add('bg-green-100');
                    statusText = `üöÄ C·∫§T C√ÅNH! L·ª±c r√≤ng: +${F_net.toFixed(2)} N`;
                    translateY = -90; 
                    fireOpacity = 1;

                } else if (F_net < 0) {
                    statusOutput.classList.remove('bg-gray-100', 'bg-green-100');
                    statusOutput.classList.add('bg-yellow-100');
                    statusText = `‚¨áÔ∏è H·∫† XU·ªêNG! L·ª±c r√≤ng: ${F_net.toFixed(2)} N`;
                    translateY = 0; 
                    fireOpacity = 0.5;

                } else {
                    statusOutput.classList.remove('bg-green-100', 'bg-yellow-100');
                    statusOutput.classList.add('bg-gray-100');
                    statusText = `‚öñÔ∏è C√ÇN B·∫∞NG! L·ª±c r√≤ng: 0 N`;
                    translateY = -15; 
                    fireOpacity = 0.7;
                }

                // Hi·ªÉn th·ªã th√¥ng tin tr·∫°ng th√°i
                let minTempDisplay = isFinite(T_in_min_C) ? T_in_min_C.toFixed(1) : 'Kh√¥ng th·ªÉ c·∫•t c√°nh';
                statusOutput.querySelector('p:first-child').innerHTML = statusText + `<br><span class="text-sm font-normal text-gray-500">T_c·∫•t c√°nh t·ªëi thi·ªÉu: ${minTempDisplay} ¬∞C</span>`;
                netForceDisplay.textContent = netForceText;

                // C·∫≠p nh·∫≠t ho·∫°t ·∫£nh khinh kh√≠ c·∫ßu
                balloonWrapper.style.transform = `translateY(${translateY}%)`;
                fireEffect.style.opacity = fireOpacity;
                
                // =================================================================
                // C·∫≠p nh·∫≠t khu v·ª±c chi ti·∫øt c√°c b∆∞·ªõc gi·∫£i (ƒê√£ thay ƒë·ªïi logic)
                // =================================================================
                
                const stepsHTML = `
                    <div class="calculation-step">
                        <p class="font-semibold">B∆∞·ªõc 1: T√≠nh M·∫≠t ƒë·ªô Kh√≠ Ngo√†i ($D_{out}$) & L·ª±c ƒë·∫©y ($F_B$)</p>
                        <p class="text-xs italic text-gray-600">C√¥ng th·ª©c: $D_{out} = \\frac{P_{out} \\cdot M}{R \\cdot T_{out}}$ | $F_B = D_{out} \\cdot V \\cdot g$</p>
                        <p class="mt-1">K·∫øt qu·∫£: $D_{out} = ${rho_out.toFixed(4)}$ $kg/m^3$. $F_B = ${F_B.toFixed(0)}$ N</p>
                    </div>
                    
                    <div class="calculation-step bg-yellow-50 rounded-lg p-2">
                        <p class="font-semibold text-orange-700">B∆∞·ªõc 2: X√°c ƒë·ªãnh Kh·ªëi l∆∞·ª£ng Kh√≠ T·ªëi thi·ªÉu c·∫ßn thi·∫øt</p>
                        <p class="text-xs italic text-gray-600">√Åp d·ª•ng ƒëi·ªÅu ki·ªán c·∫•t c√°nh ($F_B = F_g$): $D_{out} \\cdot V = m_{v·ªè} + m_{k, c·∫ßn}$</p>
                        <p class="mt-1">Kh·ªëi l∆∞·ª£ng kh√≠ n√≥ng c·∫ßn ($m_{k, c·∫ßn}$): ${m_k_required.toFixed(2)} kg</p>
                        <p class="mt-1 font-bold">Nhi·ªát ƒë·ªô t·ªëi thi·ªÉu ($T_{in, min}$): ${minTempDisplay} ¬∞C</p>
                    </div>

                    
                `;

                calculationSteps.innerHTML = stepsHTML;
		if (window.MathJax) {
			    MathJax.typesetPromise([calculationSteps]);
		}

            }

            // G·∫Øn s·ª± ki·ªán l·∫Øng nghe
            document.querySelectorAll('input').forEach(input => {
                input.addEventListener('input', calculateAndAnimate);
            });

            // G·∫Øn s·ª± ki·ªán cho thanh tr∆∞·ª£t
            insideTempSlider.addEventListener('input', calculateAndAnimate);

            // Ch·∫°y l·∫ßn ƒë·∫ßu ti√™n ƒë·ªÉ thi·∫øt l·∫≠p tr·∫°ng th√°i ban ƒë·∫ßu
            window.onload = function() {
                calculateAndAnimate();
            };
        })(); // K·∫øt th√∫c IIFE
    </script>
</body>
</html>
